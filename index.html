<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Ubungo Municipal Web Atlas</title>
<!-- Cesium -->
<link href="https://cesium.com/downloads/cesiumjs/releases/1.114/Build/Cesium/Widgets/widgets.css" rel="stylesheet"/>
<script src="https://cesium.com/downloads/cesiumjs/releases/1.114/Build/Cesium/Cesium.js"></script>
<!-- Leaflet -->
<link href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" rel="stylesheet"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
  :root{
    --bg: #061018;
    --panel: rgba(10, 20, 28, 0.72);
    --panel2: rgba(10, 20, 28, 0.55);
    --text: #e8f2ff;
    --muted: rgba(232,242,255,0.72);
    --accent: #1abc9c;
    --accent2:#3498db;
    --border: rgba(255,255,255,0.12);
    --shadow: 0 18px 45px rgba(0,0,0,0.45);
    --radius: 18px;
  }

  html, body{
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    overflow:hidden; /* key: no scrolling */
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Poppins", Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
  }

  /* App screens (Home + Atlas) */
  .section{
    position: fixed; /* keep out of document flow */
    inset: 0;
    width: 100vw;
    height: 100vh;

    /* Fade animation */
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 450ms ease, visibility 450ms ease;
  }
  .section.active{
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  /* ================= HOME ================= */
  #home{ background: var(--bg); }

  #globe{
    position:absolute;
    inset:0;
    width:100%;
    height:100%;
  }

  /* Dark overlay gradient to make text readable */
  .hero-scrim{
    position:absolute;
    inset:0;
    background:
      radial-gradient(1200px 700px at 18% 20%, rgba(26,188,156,0.22), transparent 55%),
      radial-gradient(1000px 600px at 78% 75%, rgba(52,152,219,0.18), transparent 60%),
      linear-gradient(180deg, rgba(0,0,0,0.55), rgba(0,0,0,0.35));
    pointer-events:none;
  }

  /* Top bar */
  .topbar{
    position:absolute;
    top: 18px;
    left: 18px;
    right: 18px;
    display:flex;
    gap:14px;
    align-items:center;
    justify-content:space-between;
    z-index: 5;
  }

  .brand{
    display:flex;
    gap:12px;
    align-items:center;
    padding: 10px 14px;
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 999px;
    backdrop-filter: blur(10px);
    box-shadow: var(--shadow);
  }
  .brand-badge{
    width: 34px;
    height: 34px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(26,188,156,0.95), rgba(52,152,219,0.85));
    display:grid;
    place-items:center;
    font-weight:800;
  }
  .brand-title{
    display:flex;
    flex-direction:column;
    line-height:1.05;
  }
  .brand-title b{ font-size: 13px; letter-spacing:0.2px; }
  .brand-title span{ font-size: 12px; color: var(--muted); }

  .topbar-actions{
    display:flex;
    gap:10px;
    align-items:center;
  }

  .chip{
    padding: 10px 12px;
    background: var(--panel2);
    border: 1px solid var(--border);
    border-radius: 999px;
    backdrop-filter: blur(10px);
    font-size: 12px;
    color: var(--muted);
    display:flex;
    gap:8px;
    align-items:center;
  }

  #basemapStatus{
    font-size: 12px;
    color: var(--muted);
  }

  /* Main hero card */
  .hero{
    position:absolute;
    left: 6%;
    top: 18%;
    width: min(680px, 88vw);
    z-index: 5;
  }

  .hero-card{
    position: relative;
    background: 
      linear-gradient(rgba(6,16,24,0.78), rgba(6,16,24,0.88)),
      url('./ardhi_university_1280x640.jpg');
    background-size: cover;
    background-position: center;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 26px 26px 18px 26px;
    box-shadow: var(--shadow);
    backdrop-filter: blur(12px);
    overflow: hidden;
  }

  .kicker{
    display:flex;
    gap:10px;
    align-items:center;
    color: var(--muted);
    font-size: 12px;
    letter-spacing: 0.3px;
    text-transform: uppercase;
  }

  .hero-card h1{
    margin: 10px 0 10px 0;
    font-size: clamp(28px, 4.2vw, 40px);
    letter-spacing: -0.4px;
  }

  .hero-card p{
    margin: 0 0 14px 0;
    color: var(--muted);
    font-size: 14px;
    line-height: 1.6;
  }

  .cta-row{
    display:flex;
    gap:12px;
    flex-wrap: wrap;
    align-items:center;
    margin-top: 10px;
  }

  .btn{
    border: 1px solid rgba(255,255,255,0.16);
    border-radius: 14px;
    padding: 12px 14px;
    cursor:pointer;
    font-weight: 700;
    font-size: 14px;
    display:flex;
    gap:10px;
    align-items:center;
    user-select:none;
    transition: transform 140ms ease, filter 140ms ease;
  }
  .btn:active{ transform: translateY(1px); }

  .btn-primary{
    background: rgba(26,188,156,0.95);
    color: #04221c;
  }
  .btn-secondary{
    background: rgba(255,255,255,0.06);
    color: var(--text);
  }
  .btn:hover{ filter: brightness(1.06); }

  .divider{
    height: 1px;
    background: rgba(255,255,255,0.10);
    margin: 16px 0 14px 0;
  }

  .stats{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 10px;
    margin-top: 10px;
  }
  .stat{
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 14px;
    padding: 12px 12px;
  }
  .stat b{ font-size: 16px; }
  .stat span{ display:block; font-size: 12px; color: var(--muted); margin-top: 4px; }

  .features{
    display:flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 12px;
  }
  .pill{
    font-size: 12px;
    color: var(--muted);
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.10);
    padding: 8px 10px;
    border-radius: 999px;
  }

  /* Home controls (labels/borders/search) */
  #globeControls{
    position:absolute;
    bottom:16px;
    right:16px;
    display:flex;
    gap:10px;
    align-items:center;
    background: rgba(0,0,0,0.50);
    color:#fff;
    padding: 10px 12px;
    border-radius: 14px;
    font-size: 12px;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.12);
    z-index: 6;
  }
  #globeControls input[type="text"]{
    width: 190px;
    padding: 7px 9px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.20);
    background: rgba(255,255,255,0.10);
    color:#fff;
    outline:none;
  }
  #globeControls button{
    padding: 7px 11px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.20);
    background: rgba(26,188,156,0.90);
    color:#fff;
    cursor:pointer;
  }

  /* ================= ATLAS ================= */
  /* IMPORTANT: do NOT set #explore display:flex here (it caused your ‚Äúextra page‚Äù). */
  #explore{
    background: #0b141c;
  }
  /* Only when active, Atlas becomes flex */
  #explore.active{
    display:flex;
  }

  .sidebar{
    width: 320px;
    background: rgba(255,255,255,0.06);
    border-right: 1px solid rgba(255,255,255,0.10);
    padding: 14px;
    overflow-y: auto;
  }

  .sidebar .title{
    display:flex;
    gap:10px;
    align-items:center;
    padding: 10px 10px;
    border-radius: 14px;
    background: rgba(0,0,0,0.25);
    border: 1px solid rgba(255,255,255,0.10);
    margin-bottom: 12px;
  }
  .sidebar .title b{ font-size: 13px; }
  .sidebar .title span{ font-size: 12px; color: var(--muted); display:block; margin-top:2px; }

  .sidebar button{
    width: 100%;
    padding: 11px 12px;
    margin-bottom: 10px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(52,152,219,0.80);
    color: white;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 700;
  }
  .sidebar button.secondary{
    background: rgba(255,255,255,0.06);
  }

  .content{
    flex: 1;
    position: relative;
  }
  #map{
    position: relative;
    inset:0;
    width: 100%;
    height: 100%;
  }

  #dashboard{
    position:absolute;
    inset:0;
    display:none;
    padding: 26px;
    overflow:auto;
  }
  .dash-grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 12px;
    margin-top: 14px;
  }
  .dash-card{
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 16px;
    padding: 14px;
  }
  .dash-card b{ font-size: 18px; }
  .dash-card span{ display:block; margin-top: 4px; color: var(--muted); font-size: 12px; }


  .dash-section{
    margin-top: 18px;
    padding-top: 14px;
    border-top: 1px solid rgba(255,255,255,0.12);
  }
  .dash-section h2{
    margin: 0 0 10px 0;
    font-size: 16px;
    letter-spacing: .2px;
  }
  .dash-actions{
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 12px;
    margin-top: 8px;
  }
  .dash-action{
    text-align: left;
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 16px;
    padding: 14px;
    color: var(--text);
    cursor: pointer;
    transition: transform .12s ease, background .12s ease, border-color .12s ease;
  }
  .dash-action:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,0.09);
    border-color: rgba(255,255,255,0.16);
  }
  .dash-action b{ display:block; font-size: 16px; margin-bottom: 4px; }
  .dash-action span{ display:block; font-size: 12px; color: var(--muted); line-height: 1.4; }

  /* Small screens */
  @media (max-width: 920px){
    .hero{ left: 4%; top: 14%; }
    .stats{ grid-template-columns: 1fr; }
    .sidebar{ width: 280px; }
    #globeControls input[type="text"]{ width: 150px; }
  }

  /* ================= MAP UX OVERLAYS (Legend / Coords / Toast) ================= */
  #map-ui{
    position:absolute;
    inset:0;
    z-index: 1200; /* above map */
    pointer-events:none; /* allow map interaction */
  }

  .map-chip{
    position:absolute;
    left: 16px;
    bottom: 60px; /* keep above scale bar */
    padding: 8px 10px;
    background: rgba(10, 20, 28, 0.65);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 999px;
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 28px rgba(0,0,0,0.35);
    font-size: 12px;
    color: rgba(232,242,255,0.78);
    letter-spacing: 0.2px;
    pointer-events:none;
  }

  .map-legend{
    position:absolute;
    right: 16px;
    bottom: 16px;
    width: 260px;
    background: rgba(10, 20, 28, 0.72);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 14px;
    backdrop-filter: blur(12px);
    box-shadow: 0 14px 34px rgba(0,0,0,0.45);
    overflow:hidden;
    pointer-events:auto; /* clickable */
  }

  .legend-header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    padding: 10px 12px;
    font-size: 12px;
    color: rgba(232,242,255,0.9);
    border-bottom: 1px solid rgba(255,255,255,0.10);
  }

  .legend-toggle{
    width: 28px;
    height: 28px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: rgba(232,242,255,0.85);
    cursor:pointer;
  }
  .legend-toggle:hover{ background: rgba(255,255,255,0.10); }

  .legend-body{
    padding: 10px 12px;
    max-height: 220px;
    overflow:auto;
  }
  .map-legend.collapsed .legend-body{ display:none; }
  .map-legend.collapsed .legend-toggle{ transform: rotate(-90deg); }

  .legend-row{
    display:flex;
    align-items:center;
    gap:10px;
    padding: 6px 0;
    font-size: 12px;
    color: rgba(232,242,255,0.78);
  }
  .legend-swatch{
    width: 14px;
    height: 14px;
    border-radius: 6px;
    border: 2px solid rgba(26,188,156,0.95);
    background: rgba(26,188,156,0.16);
    flex: 0 0 auto;
  }
  .legend-text{ line-height: 1.25; }

  /* Toasts */
  #toastHost{
    position:absolute;
    top: 16px;
    left: 50%;
    transform: translateX(-50%);
    display:flex;
    flex-direction:column;
    gap:10px;
    width: min(520px, calc(100vw - 32px));
    pointer-events:none;
  }
  .toast{
    pointer-events:none;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(10, 20, 28, 0.78);
    backdrop-filter: blur(12px);
    box-shadow: 0 14px 34px rgba(0,0,0,0.45);
    color: rgba(232,242,255,0.92);
    font-size: 12px;
    display:flex;
    justify-content:space-between;
    gap:12px;
    opacity: 0;
    transform: translateY(-6px);
    transition: opacity 200ms ease, transform 200ms ease;
  }
  .toast.show{
    opacity: 1;
    transform: translateY(0);
  }
  .toast .tag{
    flex: 0 0 auto;
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 11px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: rgba(232,242,255,0.8);
  }
  .toast.info .tag{ border-color: rgba(52,152,219,0.55); }
  .toast.success .tag{ border-color: rgba(26,188,156,0.60); }
  .toast.error .tag{ border-color: rgba(231,76,60,0.60); }


  /* ================= ABOUT MODAL (UI ONLY) ================= */
  .chip-btn{
    cursor: pointer;
    color: var(--text);
  }
  .chip-btn:hover{
    filter: brightness(1.06);
  }

  .modal{
    position: fixed;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 22px;
    background: rgba(0,0,0,0.58);
    z-index: 9999;
  }
  .modal.open{ display: flex; }

  .modal-card{
    width: min(860px, 92vw);
    max-height: min(76vh, 720px);
    overflow: auto;
    background: rgba(10, 20, 28, 0.86);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 18px;
    box-shadow: 0 22px 60px rgba(0,0,0,0.55);
    backdrop-filter: blur(14px);
  }

  .modal-head{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap: 14px;
    padding: 16px 16px 10px 16px;
    border-bottom: 1px solid rgba(255,255,255,0.10);
  }
  
  .modal-head-actions{
    display:flex;
    align-items:center;
    gap:10px;
    flex-shrink:0;
  }
  .modal-action-btn{
    padding:8px 12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.14);
    background:rgba(255,255,255,0.08);
    color:rgba(232,242,255,0.92);
    cursor:pointer;
    font-weight:800;
  }
  .modal-action-btn:hover{ filter: brightness(1.06); }
.modal-head h2{
    margin: 0;
    font-size: 18px;
    letter-spacing: .2px;
  }
  .modal-head p{
    margin: 6px 0 0 0;
    color: var(--muted);
    font-size: 12px;
    line-height: 1.45;
  }
  .modal-close{
    width: 34px;
    height: 34px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: rgba(232,242,255,0.92);
    cursor:pointer;
  }
  .modal-close:hover{ background: rgba(255,255,255,0.10); }

  .modal-body{
    padding: 14px 16px 18px 16px;
    color: rgba(232,242,255,0.88);
    font-size: 13px;
    line-height: 1.6;
  }
  .modal-grid{
    display:grid;
    grid-template-columns: 1.1fr .9fr;
    gap: 14px;
  }
  .modal-panel{
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 16px;
    padding: 12px 12px;
  }
  .modal-panel b{
    display:block;
    margin-bottom: 6px;
  }
  .modal-body ul{
    margin: 8px 0 0 18px;
    padding: 0;
    color: rgba(232,242,255,0.80);
  }
  .modal-body li{ margin: 4px 0; }
  @media (max-width: 860px){
    .modal-grid{ grid-template-columns: 1fr; }
  }


/* Show home-only controls (labels, borders, contact, search) only on HOME */
#explore #globeControls,
#explore .topbar-actions,
#explore #contactBtn,
#explore #labelsToggle,
#explore #bordersToggle {
  display: none !important;
}


  /* ================= HOME CONTROLS FADE (during transition) ================= */
  #home .topbar,
  #home .hero,
  #home #globeControls{
    transition: opacity 320ms ease, transform 320ms ease;
    opacity: 1;
  }
  #home .topbar{ transform: translateY(0); }
  #home .hero{ transform: translateY(0); }
  #home #globeControls{ transform: translateY(0); }

  /* When HOME section is not active, fade controls out smoothly */
  #home:not(.active) .topbar{
    opacity: 0;
    transform: translateY(-8px);
  }
  #home:not(.active) .hero{
    opacity: 0;
    transform: translateY(-6px);
  }
  #home:not(.active) #globeControls{
    opacity: 0;
    transform: translateY(10px);
  }


  /* ================= ATLAS FLOATING SETTINGS ================= */
  .atlas-settings-btn{
    position:absolute;
    top: 16px;
    right: 16px;
    z-index: 1400;
    width: 40px;
    height: 40px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(10, 20, 28, 0.72);
    color: rgba(232,242,255,0.92);
    box-shadow: 0 14px 34px rgba(0,0,0,0.45);
    backdrop-filter: blur(12px);
    cursor:pointer;
    pointer-events:auto;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 18px;
    line-height: 1;
  }
  .atlas-settings-btn:hover{ background: rgba(10, 20, 28, 0.80); }

  .atlas-settings{
    position:absolute;
    top: 64px;
    right: 16px;
    z-index: 1400;
    width: 260px;
    background: rgba(10, 20, 28, 0.78);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 16px;
    box-shadow: 0 18px 45px rgba(0,0,0,0.55);
    backdrop-filter: blur(14px);
    overflow:hidden;
    pointer-events:auto;
    transform-origin: top right;
    transform: translateY(-6px) scale(0.98);
    opacity: 0;
    visibility: hidden;
    transition: opacity 180ms ease, transform 180ms ease, visibility 180ms ease;
  }
  .atlas-settings.open{
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }
  .atlas-settings .head{
    padding: 10px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    border-bottom: 1px solid rgba(255,255,255,0.10);
    color: rgba(232,242,255,0.92);
    font-size: 12px;
    letter-spacing: .2px;
  }
  .atlas-settings .body{
    padding: 10px 12px 12px 12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    color: rgba(232,242,255,0.86);
    font-size: 12px;
  }
  .atlas-settings label{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding: 8px 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.06);
  }
  .atlas-settings select, .atlas-settings input[type="checkbox"]{
    pointer-events:auto;
  }
  .atlas-settings select{
    width: 120px;
    padding: 6px 8px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.25);
    color: rgba(232,242,255,0.92);
    outline:none;
  }
  .atlas-settings .xbtn{
    width: 28px;
    height: 28px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: rgba(232,242,255,0.92);
    cursor:pointer;
  }
  .atlas-settings .xbtn:hover{ background: rgba(255,255,255,0.10); }


  /* Settings search row */
  .atlas-settings .search-row{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .atlas-settings .search-row input{
    flex: 1 1 auto;
    padding: 7px 9px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.25);
    color: rgba(232,242,255,0.92);
    outline:none;
  }
  .atlas-settings .search-row button{
    flex: 0 0 auto;
    padding: 7px 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(52,152,219,0.80);
    color: #fff;
    cursor:pointer;
    font-weight:800;
  }
  .atlas-settings .search-row button:hover{ filter: brightness(1.06); }



      /* ================= Optional UI visibility defaults ================= */
  /* Floating Contact button stays hidden (Contact is inside About Us modal) */
  #contactBtn{ display:none !important; }

  /* North arrow removed */
  img[src*="North_arrow.svg"]{ display:none !important; }

  /* ===== Atlas Map Search panel (toggle in Atlas settings) ===== */
  #mapSearchPanel{
    position:absolute;
    top:12px;
    left:50%;
    transform:translateX(-50%);
    width:min(420px, calc(100% - 28px));
    z-index:2500;
    pointer-events:auto;
    display:none;
  }
  #mapSearchPanel .row{
    display:flex;
    gap:8px;
    align-items:center;
  }
  #mapSearchPanel input{
    flex:1;
    padding:10px 12px;
    border-radius: 12px;
    border:1px solid rgba(255,255,255,0.18);
    background: rgba(255,255,255,0.08);
    color: rgba(232,242,255,0.95);
    outline:none;
  }
  #mapSearchPanel button{
    padding:10px 12px;
    border-radius: 12px;
    border:1px solid rgba(255,255,255,0.18);
    background: rgba(52,152,219,0.72);
    color:#fff;
    font-weight: 900;
    cursor:pointer;
    white-space:nowrap;
  }
  #mapSearchPanel .hint{
    margin-top:8px;
    font-size: 12px;
    color: rgba(232,242,255,0.70);
  }

  /* ===== Metadata modal (layer-aware) ===== */
#layerMetaModal{
  display:none;
  position: fixed;
  inset:0;
  background: rgba(0,0,0,0.55);
  z-index: 10050;
  align-items:center;
  justify-content:center;
  padding: 14px;
}
#layerMetaCard{
  display:inline-block;                 /* shrink-wrap */
  width: fit-content;                   /* size to content */
  max-width: min(600px, calc(100vw - 28px));
  min-width: min(360px, calc(100vw - 28px));
  background: rgba(10, 20, 28, 0.92);
  border: 1px solid rgba(255,255,255,0.16);
  border-radius: 18px;
  box-shadow: 0 18px 55px rgba(0,0,0,0.55);
  backdrop-filter: blur(10px);
}
#layerMetaCard .head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 12px 14px;
  border-bottom: 1px solid rgba(255,255,255,0.10);
}
#layerMetaCard .head b{
  color: rgba(232,242,255,0.96);
  font-size: 14px;
  letter-spacing: .2px;
}
#layerMetaClose{
  width: 34px;
  height: 34px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  color: rgba(232,242,255,0.92);
  cursor: pointer;
  font-weight: 900;
}
#layerMetaClose:hover{ filter: brightness(1.08); }

#layerMetaCard .body{
  padding: 12px 14px 14px 14px;
  max-height: min(70vh, calc(100vh - 180px));
  overflow:auto;                        /* scroll only if too tall */
}

/* neat key/value layout that adapts to content width */
.meta-grid{
  display:grid;
  grid-template-columns: max-content minmax(180px, 1fr);
  gap: 10px 14px;
  align-items:start;
}
.meta-k{
  color: rgba(232,242,255,0.78);
  font-size: 12.5px;
  font-weight: 800;
  white-space: nowrap;
}
.meta-v{
  color: rgba(232,242,255,0.92);
  font-size: 12.5px;
  line-height: 1.45;
  word-break: break-word;
  overflow-wrap: anywhere;
}


</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script></head>
<body>
<!-- ================= HOME ================= -->
<div aria-label="Home" class="section active" id="home">
<div id="globe"></div>
<div class="hero-scrim"></div>
<div class="topbar">
<div class="brand" title="Ubungo Municipal Web Atlas">
<div class="brand-badge">UM</div>
<div class="brand-title">
<b>UBUNGO MUNICIPAL ATLAS</b>
<span>3D Globe ‚Ä¢ 2D Maps </span>
</div>
</div>
<div class="topbar-actions">
<div class="chip">
<span style="opacity:.9">Basemap:</span>
<span id="basemapStatus">Loading‚Ä¶</span>
</div>
<div class="chip" title="Data source">
        üõ∞Ô∏è Esri World Imagery
      </div>
<button aria-controls="aboutModal" aria-haspopup="dialog" class="chip chip-btn" id="aboutBtn" title="About this project" type="button">
        ‚ÑπÔ∏è About Us
      </button>
</div>
</div>
<div class="hero">
<div class="hero-card">
<div class="kicker">üìç Ubungo Municipal ‚Ä¢ Dar es Salaam ‚Ä¢ Tanzania</div>
<h1><b>WELCOME</b></h1>
<p>
        Explore Ubungo in <b>3D</b> and <b>2D</b>, visualize environmental layers, Road network map, Topographic map, Social services maps
        and a detailed dashboard.


        This Atlas was prepared by <b>Group No:05</b>
</p>
<div class="cta-row">
<div class="btn btn-primary" onclick="showExplore()">
          üó∫ Enter Atlas
          <span style="opacity:.9;font-weight:800">‚Üí</span>
</div>
<div class="btn btn-secondary" onclick="viewer.camera.flyHome(1.8)">
          üåç Reset Globe View
        </div>
</div>
<div class="divider"></div>
<div class="stats">
<div class="stat"><b>3D Globe</b><span>Cesium + imagery overlays</span></div>
<div class="stat"><b>2D Map</b><span>Leaflet sample layers</span></div>
</div>
</div>
</div>
</div>
<input id="placeSearch" type="text"/>
<button id="searchBtn">Go</button>
</div>
<!-- ================= ATLAS ================= -->
<div aria-label="Atlas" class="section" id="explore">
<div class="sidebar">
<button class="secondary" onclick="showHome()">‚Üê Home</button>
<div class="title">
<div style="width:34px;height:34px;border-radius:12px;background:rgba(26,188,156,0.85);display:grid;place-items:center;font-weight:900">üó∫</div>
<div>
<b>Explore Ubungo</b>
<span>2D layers &amp; dashboard</span>
</div>
</div><div class="sidebar-controls">
<button aria-expanded="false" class="secondary layers-toggle" id="layersToggle" type="button">
    Layers <span class="chev">‚ñ∏</span>
</button>
<div aria-label="Resize sidebar" class="sidebar-size-buttons">
<button class="secondary" id="sidebarSmaller" title="Make sidebar smaller" type="button">‚àí</button>
<button class="secondary" id="sidebarLarger" title="Make sidebar larger" type="button">+</button>
</div>
</div><div class="layers-group" id="layersGroup"><button onclick="showMap(); loadLayer('landcover')">Landcover Map</button><button onclick="showMap(); loadLayer('police')">Police Stations Map</button><button onclick="showMap(); loadLayer('health')">Public Health Centres Map</button><button onclick="showMap(); loadLayer('primary')">Public Primary Schools Map</button><button onclick="showMap(); loadLayer('secondary')">Public Secondary Schools Map</button><button onclick="showMap(); loadLayer('roads')">Road Network Map</button><button onclick="showMap(); loadLayer('transport')">Transport Network Map</button><button onclick="showMap(); loadLayer('water')">Water Supply Network</button><button onclick="showMap(); loadLayer('boreholes')">Borehole Map &amp; Service Areas</button><button onclick="showMap(); loadLayer('popdist')">Population Distribution</button><button onclick="showMap(); loadLayer('popdens')">Population Density Map</button><button onclick="showMap(); loadLayer('slope')">Slope Map</button><button onclick="showMap(); loadLayer('aspect')">Aspect Map</button><button onclick="showMap(); loadLayer('hillshade')">Hillshade Map</button><button onclick="showMap(); loadLayer('contours')">Contours Map</button><button onclick="showMap(); loadLayer('topo')">Topographic Map</button><button onclick="showMap(); loadLayer('lcchange')">Landcover Change Map</button><button onclick="showMap(); loadLayer('landuse')">Land Use Map</button><button onclick="showMap(); loadLayer('rainfall')">Rainfall Map</button><button onclick="showMap(); loadLayer('airtemp')">Air Temperature Map</button><button onclick="showMap(); loadLayer('lst')">Land Surface Temperature Map</button><button onclick="showMap(); loadLayer('ndvi')">Normalized Difference Vegetation Index (NDVI)</button></div>
<div style="height:10px"></div>
<button class="secondary" onclick="showDashboard()">üìä View Dashboard</button>

<div aria-label="Resize sidebar" class="sidebar-resizer" id="sidebarResizer" role="separator"></div></div>
<div class="content">
<div id="map">
<!-- Map UI overlays (professional UX) -->
<div id="map-ui">
  <!-- Atlas settings (floating) -->
  <button id="atlasSettingsBtn" class="atlas-settings-btn" type="button" aria-label="Atlas settings">‚öô</button>
  <div id="atlasSettings" class="atlas-settings" role="dialog" aria-label="Atlas settings panel" aria-hidden="true">
    <div class="head">
      <b>Atlas settings</b>
      <button id="atlasSettingsClose" class="xbtn" type="button" aria-label="Close settings">‚úï</button>
    </div>
    <div class="body">
<label>
        <span>Labels</span>
        <input id="atlasToggleLabels" type="checkbox" checked>
      </label>

      <label>
        <span>Borders</span>
        <input id="atlasToggleBorders" type="checkbox" checked>
      </label>
      <label>
        <span>Search panel</span>
        <input id="atlasToggleSearch" type="checkbox">
      </label>

      <label>
        <span>Scale bar</span>
        <input id="atlasToggleScale" type="checkbox">
      </label>

<label>
        <span>Basemap</span>
        <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; width:100%;">
          <select id="atlasBasemap" style="flex:1;">
            <option value="imagery" selected>Imagery</option>
            <option value="streets">Streets</option>
          </select>
          <button id="atlasBasemapToggleBtn" type="button" class="toggle-btn" aria-pressed="true">ON</button>
        </div>
      </label>
      <label>
        <span>Show legend</span>
        <input id="atlasShowLegend" type="checkbox" checked>
      </label>
<div style="margin-top:8px; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,0.12); background:rgba(255,255,255,0.06); color:rgba(232,242,255,0.82); font-size:12.5px;">
  <b style="color:rgba(232,242,255,0.95)">Selected layer:</b>
  <span id="atlasCurrentLayerName" class="meta-pill">None</span>
</div>
<div style="display:grid; grid-template-columns: 1fr; gap:10px; margin-top: 10px;">
  <button id="atlasMetaBtn" type="button" style="width:100%; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,0.14); background:rgba(52,152,219,0.72); color:#fff; cursor:pointer; font-weight:800;">Metadata</button>
  <button id="atlasExportBtn" type="button" style="width:100%; padding:10px 12px; border-radius:14px; border:1px solid rgba(255,255,255,0.14); background:rgba(26,188,156,0.78); color:#04221c; cursor:pointer; font-weight:900;">Export layer</button>
</div>

</div>
  
  <!-- Map Search (toggle in Atlas settings) -->
  <div id="mapSearchPanel" aria-label="Place search panel">
    <div class="row">
      <input id="atlasSearchInput" type="text" placeholder="Search places (e.g., Ubungo, Kimara, Sinza)">
      <button id="atlasSearchGo" type="button">Search</button>
    </div>
    
  </div>

</div>
<div aria-label="Map legend" class="map-legend collapsed" id="mapLegend">
<div class="legend-header">
<span>Legend</span>
<button aria-label="Toggle legend" class="legend-toggle" id="legendToggle" type="button">‚ñæ</button>
</div>
<div class="legend-body" id="legendBody">
<div class="legend-row">
<span class="legend-swatch"></span>
<span class="legend-text">No layer selected</span>
</div>
</div>
</div>
<div aria-atomic="true" aria-live="polite" id="toastHost"></div>
</div>
</div>
<div id="dashboard">
<h1 style="margin:0 0 6px 0">Dashboard Overview</h1>
<div class="dash-grid">
<div class="dash-card">üåø <b id="kpiNdvi">--</b><span>Mean NDVI</span></div>
<div class="dash-card">üåß <b id="kpiRain">--</b><span>Rainfall (mm/month)</span></div>
<div class="dash-card">üå° <b id="kpiAT">--</b><span>Air Temperature (¬∞C)</span></div>
<div class="dash-card">üî• <b id="kpiLST">--</b><span>LST (¬∞C)</span></div>
</div>
<div class="dash-section">
<h2>Climate</h2>
<div style="color:rgba(255,255,255,0.75);font-size:13px;margin-bottom:8px">
          Analytical layers for climate relationships and patterns.
        </div>
<div class="dash-actions">
<button class="dash-action" onclick="window.location.href='Correlation.html'">
<b>Correlation</b>
<span>Explore relationships between climate variables (demo placeholder).</span>
</button>
<button class="dash-action" onclick="window.location.href='Trend.html'">
<b>Trend</b>
<span>View time-based climate trends (demo placeholder).</span>
</button>
</div>
</div>
</div>
</div>
</div>
<script>
/* ============ Screen switching (with fade) ============ */
function showHome(){
  document.getElementById('explore').classList.remove('active');
  document.getElementById('home').classList.add('active');
}

function showExplore(){
  document.getElementById('home').classList.remove('active');
  document.getElementById('explore').classList.add('active');
  setTimeout(()=>map.invalidateSize(), 500); // after fade
}

function showDashboard(){
  document.getElementById('map').style.display = 'none';
  document.getElementById('dashboard').style.display = 'block';
}

function showMap(){
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('map').style.display = 'block';
  map.invalidateSize();
}

function setStatus(text){
  const el = document.getElementById('basemapStatus');
  if(el) el.textContent = text;
}

/* ============ Cesium Globe ============ */
function makeEsriWorldImageryProvider(){
  return new Cesium.UrlTemplateImageryProvider({
    url: 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
  });
}

const viewer = new Cesium.Viewer('globe',{
  animation:false,
  timeline:false,
  baseLayerPicker:false,
  geocoder:false,
  sceneModePicker:false,
  navigationHelpButton:false,
  fullscreenButton:false,
  homeButton:false,
  infoBox:true,
  selectionIndicator:true,
  imageryProvider:false,
  terrainProvider:new Cesium.EllipsoidTerrainProvider()
});

// Basemap
viewer.imageryLayers.addImageryProvider(makeEsriWorldImageryProvider());
setStatus('Esri World Imagery');

// Borders overlay (Esri reference layer)
const bordersLayer = viewer.imageryLayers.addImageryProvider(
  new Cesium.UrlTemplateImageryProvider({
    url: 'https://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}',
    maximumLevel: 19
  })
);
bordersLayer.alpha = 0.75;

// Labels overlay (Carto labels-only)
const labelsLayer = viewer.imageryLayers.addImageryProvider(
  new Cesium.UrlTemplateImageryProvider({
    url: 'https://{s}.basemaps.cartocdn.com/dark_only_labels/{z}/{x}/{y}.png',
    subdomains: ['a','b','c','d'],
    maximumLevel: 20,
    credit: new Cesium.Credit('¬© CARTO')
  })
);
labelsLayer.alpha = 0.95;

// Initial view is handled by Ubungo zoom
// Toggles
const toggleLabelsEl = document.getElementById('toggleLabels');
const toggleBordersEl = document.getElementById('toggleBorders');

function applyToggles(){
  labelsLayer.show = toggleLabelsEl ? !!toggleLabelsEl.checked : true;
  bordersLayer.show = toggleBordersEl ? !!toggleBordersEl.checked : true;
}
if(toggleLabelsEl) toggleLabelsEl.addEventListener('change', applyToggles);
if(toggleBordersEl) toggleBordersEl.addEventListener('change', applyToggles);
applyToggles();
// =========================
// Ubungo boundary (REAL) loaded from your repo: data/ubungo.geojson
// =========================
let ubungoGeoJSON = null;
let ubungoDataSource = null;

// Leaflet boundary holder (2D)
let ubungoLayer = null;
window.ubungoLayer = null;

function ensureLeafletUbungoBoundary(geo){
  try{
    if(typeof map === 'undefined' || !map) return;
    if(ubungoLayer){
      try{ map.removeLayer(ubungoLayer); }catch(e){}
    }
    ubungoLayer = L.geoJSON(geo, { color:'red', weight:2, fillOpacity:0 });
    ubungoLayer.addTo(map);
    window.ubungoLayer = ubungoLayer;
  }catch(e){}
}

function computeBoundingSphereFromDataSource(ds){
  try{
    const entities = (ds && ds.entities && ds.entities.values) ? ds.entities.values : [];
    const points = [];
    const now = Cesium.JulianDate.now();

    for(const ent of entities){
      try{
        // polygons
        if(ent.polygon && ent.polygon.hierarchy){
          const h = ent.polygon.hierarchy.getValue(now);
          const pos = h && h.positions;
          if(pos && pos.length) points.push(...pos);
        }
        // polylines
        else if(ent.polyline && ent.polyline.positions){
          const pos = ent.polyline.positions.getValue(now);
          if(pos && pos.length) points.push(...pos);
        }
        // points
        else if(ent.position){
          const p = ent.position.getValue(now);
          if(p) points.push(p);
        }
      }catch(e){}
    }
    if(points.length < 2) return null;
    return Cesium.BoundingSphere.fromPoints(points);
  }catch(e){
    return null;
  }
}


async function loadUbungoBoundary(){
  // --- helper: extract bbox from GeoJSON (lon/lat order) ---
  function bboxFromGeoJSON(gj){
    let minLon=Infinity, minLat=Infinity, maxLon=-Infinity, maxLat=-Infinity;

    function scanCoords(c){
      // c can be nested arrays down to [lon,lat]
      if(!c) return;
      if(typeof c[0] === 'number' && typeof c[1] === 'number'){
        const lon=c[0], lat=c[1];
        if(lon < minLon) minLon = lon;
        if(lat < minLat) minLat = lat;
        if(lon > maxLon) maxLon = lon;
        if(lat > maxLat) maxLat = lat;
        return;
      }
      for(const child of c) scanCoords(child);
    }

    try{
      if(gj.type === 'FeatureCollection') gj.features.forEach(f=>scanCoords(f.geometry && f.geometry.coordinates));
      else if(gj.type === 'Feature') scanCoords(gj.geometry && gj.geometry.coordinates);
      else scanCoords(gj.coordinates);
    }catch(e){}

    if(!isFinite(minLon) || !isFinite(minLat) || !isFinite(maxLon) || !isFinite(maxLat)) return null;
    return {minLon, minLat, maxLon, maxLat};
  }

  // --- 1) get GeoJSON (repo file) with fallback ---
  try{
    const res = await fetch('data/ubungo.geojson', { cache:'no-store' });
    if(!res.ok) throw new Error('HTTP ' + res.status);
    ubungoGeoJSON = await res.json();
  }catch(err){
    console.warn('Failed to fetch data/ubungo.geojson, using embedded fallback. Error:', err);
    ubungoGeoJSON = {"type":"FeatureCollection","name":"roi","crs":{"type":"name","properties":{"name":"urn:ogc:def:crs:OGC:1.3:CRS84"}},"features":[{"type":"Feature","properties":{"admin_leve":"5","boundary":"administrative","name":"Ubungo Municipal","ref":"4","source":"maxar","type":"boundary"},"geometry":{"type":"MultiPolygon","coordinates":[[[[39.0606941,-6.7025655],[39.0623789,-6.7025294],[39.0645795,-6.7030883],[39.065185,-6.7035307],[39.0661514,-6.7049396],[39.0665822,-6.7053588],[39.0670247,-6.7056382],[39.0673391,-6.70558],[39.0676767,-6.7053355],[39.0681075,-6.7053122],[39.0692719,-6.7058595],[39.071263,-6.706069],[39.0764793,-6.7058362],[39.0802984,-6.7051841],[39.0846877,-6.7050609],[39.0871167,-6.7047059],[39.0968702,-6.7027626],[39.0981081,-6.7022722],[39.0995982,-6.7019172],[39.1027326,-6.7012445],[39.1046571,-6.7009409],[39.1048299,-6.7008475],[39.1051569,-6.7000534],[39.1060865,-6.6989883],[39.1063994,-6.6983811],[39.1062873,-6.6980167],[39.1063154,-6.6978392],[39.1064135,-6.6977831],[39.1066564,-6.6978299],[39.1068588,-6.6980296],[39.107111,-6.6979125],[39.1074982,-6.6978855],[39.1079185,-6.6974892],[39.1080263,-6.6974643],[39.1084025,-6.6968493],[39.1085241,-6.6967277],[39.1090675,-6.6966348],[39.1092463,-6.6970137],[39.1094823,-6.6970209],[39.1096467,-6.6968278],[39.109804,-6.696885],[39.1101258,-6.6966419],[39.1105978,-6.6965704],[39.1106907,-6.6963845],[39.1111198,-6.6958768],[39.1120994,-6.6954907],[39.1124569,-6.6952476],[39.1129574,-6.695176],[39.1134866,-6.6952047],[39.1142151,-6.6948838],[39.11537,-6.6946334],[39.116315,-6.694593],[39.1171549,-6.6944315],[39.1178091,-6.6942053],[39.1179457,-6.6942129],[39.1180528,-6.6937964],[39.118168,-6.6935784],[39.1186641,-6.6931368],[39.1185202,-6.6933821],[39.1186756,-6.6935188],[39.1188185,-6.6935188],[39.1188745,-6.6936369],[39.1186818,-6.694041],[39.1186445,-6.6943705],[39.1187253,-6.694961],[39.1190112,-6.6955267],[39.1196888,-6.6965089],[39.1198131,-6.6968321],[39.1198131,-6.6971367],[39.1199188,-6.6972486],[39.1200307,-6.6976464],[39.1200245,-6.6977335],[39.1199002,-6.6978702],[39.119981,-6.6980878],[39.1197634,-6.6983427],[39.1197448,-6.6985478],[39.1200059,-6.6992067],[39.1199002,-6.699387],[39.1195769,-6.6995362],[39.1195521,-6.6996232],[39.1198442,-6.6998657],[39.1198691,-6.7000149],[39.1198442,-6.7001081],[39.1196888,-6.7002386],[39.1193594,-6.7004251],[39.1193531,-6.7006676],[39.1198691,-6.7013327],[39.1199623,-6.701656],[39.1201177,-6.7018011],[39.120314,-6.7023592],[39.1204722,-6.7025337],[39.1206195,-6.7028283],[39.1209959,-6.7028119],[39.1210504,-6.7028665],[39.1210232,-6.7030738],[39.1211814,-6.7032593],[39.1210559,-6.7034065],[39.1210832,-6.7036357],[39.1209195,-6.7040175],[39.1205322,-6.704623],[39.1201285,-6.7060305],[39.1198468,-6.7066165],[39.1199326,-6.7067273],[39.1203552,-6.7067126],[39.1206988,-6.7064807],[39.1231628,-6.7073063],[39.1241522,-6.7079785],[39.1244288,-6.7079021],[39.1246578,-6.7082742],[39.1248009,-6.70836],[39.1249631,-6.7085795],[39.1251093,-6.7090873],[39.1251729,-6.7106496],[39.1264377,-6.7123636],[39.1269485,-6.7129366],[39.1274211,-6.7133625],[39.1276097,-6.7134181],[39.1295992,-6.7129902],[39.1314402,-6.7128579],[39.1339008,-6.7122382],[39.1341535,-6.7117509],[39.1348635,-6.7109267],[39.1356124,-6.7106064],[39.1355794,-6.7101625],[39.1354602,-6.7097246],[39.1353337,-6.7095275],[39.1364713,-6.7086006],[39.1367237,-6.7083081],[39.1377968,-6.7064822],[39.1380021,-6.70589],[39.1386041,-6.7062331],[39.1385883,-6.7067287],[39.138699,-6.7072308],[39.1397627,-6.7077596],[39.1404206,-6.7084359],[39.1406518,-6.7091073],[39.1409742,-6.709278],[39.1413927,-6.7093668],[39.1422098,-6.7092352],[39.1430092,-6.7089832],[39.1432186,-6.7089682],[39.1438946,-6.7092721],[39.1442327,-6.7095857],[39.1456448,-6.7091906],[39.1459282,-6.7096438],[39.1463619,-6.7101244],[39.1468694,-6.710525],[39.1476921,-6.7109097],[39.1482665,-6.7110939],[39.1483603,-6.7108744],[39.1484803,-6.7108691],[39.1486871,-6.7105314],[39.1495352,-6.7106552],[39.1499783,-6.7103217],[39.1505071,-6.7101312],[39.1509835,-6.7099787],[39.1521079,-6.7098215],[39.152551,-6.709669],[39.1528369,-6.7094832],[39.1532538,-6.7090364],[39.153329,-6.7087203],[39.153329,-6.7082614],[39.1532086,-6.7077573],[39.1528558,-6.7070724],[39.1528559,-6.7068438],[39.1527919,-6.7067791],[39.1528273,-6.7063626],[39.1531084,-6.7054335],[39.1533562,-6.7048904],[39.1539326,-6.7037374],[39.1542757,-6.7033372],[39.1541661,-6.7023749],[39.1542185,-6.701765],[39.1541709,-6.7016602],[39.1539422,-6.7014982],[39.1537119,-6.7006473],[39.1539588,-6.6997074],[39.1540959,-6.6995841],[39.154189,-6.6993597],[39.1543077,-6.6986995],[39.1545099,-6.6983536],[39.1549246,-6.6981114],[39.1552494,-6.6976138],[39.155562,-6.6975727],[39.1564145,-6.697546],[39.156804,-6.697548],[39.1571288,-6.6973835],[39.1571946,-6.6973301],[39.15717,-6.6970874],[39.1572399,-6.6970134],[39.1575689,-6.6970093],[39.1578549,-6.6966074],[39.158112,-6.6965717],[39.1581548,-6.6965075],[39.1581048,-6.6963361],[39.1579977,-6.6962576],[39.1580263,-6.6961005],[39.1584547,-6.6959291],[39.1586904,-6.6955863],[39.1591973,-6.6955149],[39.1593544,-6.6950365],[39.1598471,-6.6947581],[39.1606326,-6.694194],[39.1608182,-6.6938869],[39.1605897,-6.6937298],[39.1606468,-6.6935513],[39.1610396,-6.6932943],[39.1611967,-6.6930372],[39.1611824,-6.6926945],[39.161468,-6.6921803],[39.1613966,-6.6919161],[39.161418,-6.6914591],[39.1617465,-6.6911235],[39.1619393,-6.6907879],[39.1621663,-6.6902025],[39.1625097,-6.6909307],[39.1626044,-6.6914162],[39.1627228,-6.6915819],[39.1629308,-6.6916757],[39.1630005,-6.6919613],[39.1629378,-6.6921216],[39.162889,-6.692686],[39.1629796,-6.6928672],[39.1631538,-6.6929577],[39.1633698,-6.6929438],[39.1636764,-6.6927696],[39.1641293,-6.6926163],[39.1642896,-6.6928045],[39.1643941,-6.6933061],[39.1643592,-6.6935221],[39.1640248,-6.6938914],[39.1638297,-6.6943026],[39.163767,-6.6950411],[39.1638645,-6.695508],[39.1640805,-6.6960585],[39.1642129,-6.6962605],[39.1646449,-6.6966368],[39.1646243,-6.696914],[39.1650003,-6.6973545],[39.165185,-6.6973964],[39.1655584,-6.6976424],[39.1657009,-6.6978746],[39.1659549,-6.6980652],[39.1663588,-6.6980885],[39.1666726,-6.69833],[39.1667512,-6.6986399],[39.1665401,-6.6988563],[39.1665332,-6.6992219],[39.1665933,-6.6993965],[39.1665588,-6.699489],[39.1668537,-6.699403],[39.1670488,-6.6992706],[39.1673972,-6.6994657],[39.1676759,-6.6995494],[39.1677944,-6.6998072],[39.167892,-6.7003019],[39.1678292,-6.7006015],[39.167885,-6.7008315],[39.1687142,-6.7007478],[39.1688953,-6.7008105],[39.169112,-6.7010637],[39.1693824,-6.7010492],[39.169181,-6.7016981],[39.169181,-6.7019442],[39.1695198,-6.7024022],[39.169781,-6.7025783],[39.1707009,-6.702459],[39.1713539,-6.703095],[39.171616,-6.7034541],[39.1719387,-6.7036515],[39.1721829,-6.7039638],[39.1722227,-6.7043045],[39.1721432,-6.7051335],[39.1724044,-6.7054685],[39.1726826,-6.7054345],[39.1728586,-6.7057468],[39.172728,-6.7061783],[39.172711,-6.706996],[39.1726372,-6.7074219],[39.1727394,-6.7075979],[39.1727507,-6.7080352],[39.1729041,-6.708285],[39.1732627,-6.7083895],[39.1733508,-6.7084745],[39.1733992,-6.7082507],[39.1735933,-6.7080743],[39.1743864,-6.7081072],[39.1745975,-6.7079523],[39.1749401,-6.7082996],[39.1754047,-6.7084122],[39.1755548,-6.7083606],[39.1757472,-6.7084732],[39.1763432,-6.7085999],[39.1766951,-6.7084732],[39.1770997,-6.7085178],[39.1778812,-6.7082861],[39.1781076,-6.7082649],[39.1782845,-6.7083285],[39.1784472,-6.7082366],[39.1786029,-6.7083498],[39.1789354,-6.7083851],[39.1791831,-6.7086752],[39.179742,-6.7091351],[39.1799129,-6.7096793],[39.1804504,-6.7105897],[39.1806423,-6.7108639],[39.1811469,-6.711363],[39.1814321,-6.7114123],[39.1825619,-6.7113685],[39.1830719,-6.7115056],[39.1836794,-6.7118263],[39.1842785,-6.7117806],[39.1846038,-6.711695],[39.1847179,-6.7115866],[39.1848605,-6.7110389],[39.1866189,-6.7100753],[39.186913,-6.7099876],[39.1870227,-6.7100095],[39.1877153,-6.7105605],[39.1880598,-6.710706],[39.1884531,-6.7107188],[39.1885851,-6.7106547],[39.1888188,-6.7107766],[39.189141,-6.7110295],[39.1894979,-6.7114788],[39.1901293,-6.7117552],[39.1905119,-6.71205],[39.1911911,-6.7123234],[39.1925722,-6.7122943],[39.1930783,-6.7121193],[39.1931323,-6.712181],[39.1928622,-6.7126826],[39.1929703,-6.7129063],[39.1933098,-6.7131841],[39.19348,-6.7142715],[39.1934873,-6.7152105],[39.1933017,-6.7160196],[39.1936051,-6.7169903],[39.1936987,-6.7181933],[39.193636,-6.7206893],[39.193678,-6.7209757],[39.1936272,-6.72175],[39.1936629,-6.724906],[39.1935985,-6.725593],[39.1939903,-6.7274199],[39.1939711,-6.7278673],[39.1936314,-6.7291063],[39.1936607,-6.7292735],[39.1935968,-6.7297209],[39.1934594,-6.7339281],[39.1935217,-6.7345344],[39.1934459,-6.7365667],[39.1934326,-6.7369681],[39.1934182,-6.7373629],[39.1934625,-6.7389155],[39.1933527,-6.7399917],[39.1933933,-6.7414719],[39.193238,-6.7429432],[39.1933785,-6.7452277],[39.193707,-6.7473081],[39.1926983,-6.7468765],[39.1922621,-6.7460632],[39.1920107,-6.7457083],[39.1914562,-6.7458044],[39.1910643,-6.7461519],[39.1907982,-6.7464772],[39.1906355,-6.7464476],[39.1903915,-6.7457674],[39.1898592,-6.7450133],[39.1893269,-6.7448063],[39.1888759,-6.7450133],[39.1883361,-6.7454538],[39.1882459,-6.7459531],[39.1881286,-6.7462239],[39.1881647,-6.7463382],[39.1883151,-6.7463743],[39.1885256,-6.7463262],[39.1886038,-6.7462961],[39.188652,-6.7461397],[39.1887964,-6.7460073],[39.1888926,-6.7460855],[39.1889829,-6.7463021],[39.1890731,-6.7468014],[39.1888806,-6.7470842],[39.1884835,-6.7474873],[39.1881586,-6.7476798],[39.1878819,-6.7477099],[39.1872201,-6.748125],[39.187054,-6.7485173],[39.1869676,-6.7489237],[39.1867598,-6.7493644],[39.1859717,-6.7496171],[39.1856047,-6.7495569],[39.1854964,-6.7491719],[39.1855145,-6.7485763],[39.1844556,-6.7481852],[39.1841488,-6.7482294],[39.1839382,-6.7483416],[39.183872,-6.7486063],[39.1838728,-6.7491098],[39.1841014,-6.7497957],[39.1840172,-6.7503251],[39.1837765,-6.7503732],[39.1831749,-6.7502289],[39.1825492,-6.7503552],[39.1823567,-6.7507222],[39.1822123,-6.7516307],[39.1817129,-6.7523285],[39.1814181,-6.7525993],[39.1812497,-6.7526488],[39.1807323,-6.7535739],[39.1811354,-6.7541635],[39.1812015,-6.7546448],[39.180467,-6.7552892],[39.1796903,-6.7555506],[39.179675,-6.7570271],[39.1795673,-6.7575654],[39.1788973,-6.758026],[39.1776339,-6.7584592],[39.1777061,-6.7590728],[39.1775617,-6.7597466],[39.1770683,-6.7602039],[39.176575,-6.7607935],[39.17619,-6.7617561],[39.1756244,-6.7616839],[39.1748904,-6.7608536],[39.1746308,-6.7600865],[39.1743008,-6.75981],[39.1739321,-6.759037],[39.1735337,-6.7589656],[39.1726774,-6.7593878],[39.171839,-6.7595068],[39.1705308,-6.7591381],[39.1698708,-6.7588943],[39.1699302,-6.7587159],[39.1702751,-6.7583175],[39.1704297,-6.7578656],[39.1705606,-6.7571817],[39.1695259,-6.7565098],[39.1689491,-6.7557071],[39.1684199,-6.7557368],[39.1677717,-6.7565158],[39.1672663,-6.756712],[39.1665111,-6.7567893],[39.1657998,-6.7567084],[39.165126,-6.7567926],[39.1647169,-6.7571175],[39.164753,-6.7574424],[39.1645966,-6.757671],[39.1638144,-6.7576109],[39.1636064,-6.757548],[39.1627663,-6.7583103],[39.1624028,-6.7589087],[39.1623078,-6.7596917],[39.1618212,-6.7606172],[39.1619694,-6.7624488],[39.1624084,-6.7635226],[39.1628391,-6.7639057],[39.1628167,-6.7640203],[39.1629264,-6.7641602],[39.1630124,-6.765466],[39.1632761,-6.7661931],[39.1632557,-6.7672989],[39.1631541,-6.7674412],[39.1629915,-6.7679413],[39.1628085,-6.7681202],[39.1626459,-6.7684088],[39.1628645,-6.7691109],[39.1630269,-6.769128],[39.1628212,-6.7698264],[39.1626713,-6.771266],[39.1623413,-6.7730228],[39.1629162,-6.7742436],[39.1631588,-6.7745585],[39.1634757,-6.7753246],[39.1641741,-6.7763092],[39.1644141,-6.7767922],[39.1647648,-6.7772845],[39.1653125,-6.7772845],[39.1663709,-6.7769307],[39.167448,-6.7771909],[39.1679042,-6.7771653],[39.168322,-6.776704],[39.1691748,-6.7764531],[39.1696848,-6.7765582],[39.1702691,-6.7762532],[39.1706613,-6.7759713],[39.1713635,-6.7763532],[39.1716813,-6.7763455],[39.1723822,-6.7762114],[39.1727824,-6.776333],[39.1731826,-6.7761877],[39.1733634,-6.7761937],[39.173651,-6.7764545],[39.1738288,-6.7764842],[39.1740867,-6.7764219],[39.1743788,-6.7764871],[39.1743718,-6.7763756],[39.1745904,-6.7763083],[39.1750893,-6.7762691],[39.1755124,-6.7761647],[39.1759053,-6.7762],[39.176268,-6.7760992],[39.1768271,-6.7755703],[39.1773862,-6.7755351],[39.1777287,-6.7755401],[39.1780359,-6.7756812],[39.1783079,-6.7761446],[39.1784238,-6.77621],[39.1786907,-6.7763309],[39.1790987,-6.7763763],[39.179688,-6.7766885],[39.1799248,-6.7767137],[39.1801313,-6.7765475],[39.1802421,-6.7763511],[39.1805544,-6.7762302],[39.1808969,-6.7759783],[39.1811387,-6.7759582],[39.1833751,-6.7747745],[39.184317,-6.7747393],[39.1847904,-6.7744975],[39.1851128,-6.7744169],[39.1854755,-6.7744018],[39.1859691,-6.7745529],[39.1865735,-6.7744924],[39.1873643,-6.7742456],[39.187727,-6.7742456],[39.1890718,-6.7740039],[39.1899597,-6.7739548],[39.1899731,-6.7738746],[39.1907892,-6.7739465],[39.1911301,-6.7741362],[39.1917833,-6.7742372],[39.1925389,-6.7745544],[39.1927011,-6.7745496],[39.1931976,-6.7750445],[39.1934706,-6.7750081],[39.1941866,-6.774547],[39.1953819,-6.7730726],[39.1959704,-6.7722231],[39.1972547,-6.7707784],[39.1974041,-6.7704071],[39.1972779,-6.7691233],[39.1989525,-6.7689018],[39.1998678,-6.7689331],[39.2002942,-6.7688488],[39.201968,-6.7687801],[39.2026443,-6.7687005],[39.2052745,-6.7686672],[39.2060113,-6.7685273],[39.206631,-6.7682788],[39.2075568,-6.7671515],[39.2079593,-6.7664439],[39.2080858,-6.766061],[39.2082871,-6.7658727],[39.2084577,-6.7658254],[39.2085723,-6.7659717],[39.2091028,-6.7662001],[39.2093557,-6.7664562],[39.2099543,-6.7665331],[39.2124544,-6.7666419],[39.2129442,-6.766802],[39.2139717,-6.7668628],[39.2143366,-6.7670292],[39.2143325,-6.7673508],[39.2155159,-6.7676439],[39.2167607,-6.7681156],[39.2182581,-6.7691497],[39.2222197,-6.7724213],[39.2235984,-6.7707288],[39.2239106,-6.7711875],[39.2241172,-6.7723355],[39.2242236,-6.7725559],[39.2252266,-6.773702],[39.2269572,-6.7758966],[39.2281219,-6.7767851],[39.2284133,-6.7770902],[39.2288771,-6.7781058],[39.2291933,-6.77948],[39.2298846,-6.780608],[39.2311487,-6.7820435],[39.2320176,-6.7827218],[39.2322425,-6.7828364],[39.2327397,-6.7828977],[39.2331576,-6.7828232],[39.2332509,-6.783168],[39.233182,-6.7834683],[39.2332753,-6.7836873],[39.2332104,-6.7843973],[39.2331373,-6.7846082],[39.234791,-6.7855076],[39.2348021,-6.7864831],[39.2343266,-6.7871896],[39.2343463,-6.7872248],[39.2344458,-6.7874029],[39.2344549,-6.7875795],[39.2346083,-6.7875587],[39.2351707,-6.7877259],[39.2355485,-6.788119],[39.2359742,-6.7881385],[39.2361218,-6.7882319],[39.2362543,-6.7884338],[39.236339,-6.78874],[39.2362108,-6.7892004],[39.2362695,-6.7895109],[39.2363932,-6.7895521],[39.2365214,-6.7895022],[39.2370555,-6.7895044],[39.2371163,-6.7897932],[39.2371229,-6.7917931],[39.2373074,-6.7918409],[39.2373456,-6.7919285],[39.2370056,-6.7930656],[39.2369881,-6.7939597],[39.2369046,-6.7940415],[39.2366098,-6.7943334],[39.2363452,-6.7946204],[39.2363676,-6.7948888],[39.235956,-6.7949959],[39.2359259,-6.7950614],[39.235903,-6.7951111],[39.2358741,-6.7951718],[39.2358359,-6.7952837],[39.2355389,-6.7952665],[39.2354543,-6.7959571],[39.2356442,-6.7975432],[39.2355106,-6.7979291],[39.2350646,-6.7991634],[39.2363988,-6.799634],[39.238184,-6.8002145],[39.240972,-6.8012081],[39.2423209,-6.8018123],[39.2511121,-6.8049921],[39.2506969,-6.8059985],[39.2503446,-6.8064962],[39.2505081,-6.8066908],[39.2505595,-6.806891],[39.2503994,-6.807589],[39.2508246,-6.807543],[39.2514695,-6.8081735],[39.251451,-6.8082318],[39.2514392,-6.8083084],[39.2515107,-6.808829],[39.2513333,-6.8093125],[39.251298,-6.8097424],[39.2511817,-6.8097759],[39.2511274,-6.8099018],[39.2510327,-6.8099022],[39.2509942,-6.809873],[39.2508211,-6.8098251],[39.2507557,-6.809785],[39.2506039,-6.809517],[39.2503067,-6.8094988],[39.2502047,-6.8096981],[39.2502833,-6.8099301],[39.2502148,-6.8102264],[39.2503121,-6.8104953],[39.2500726,-6.8108313],[39.2506433,-6.8118685],[39.2508917,-6.8121928],[39.2513212,-6.8123335],[39.2513136,-6.8124098],[39.2521386,-6.8127523],[39.2525843,-6.8128522],[39.2530391,-6.8128984],[39.2540966,-6.8130005],[39.2541976,-6.8130102],[39.2543407,-6.8137348],[39.2542182,-6.8145271],[39.2535971,-6.8144145],[39.2520839,-6.8143541],[39.2515575,-6.8140453],[39.2510065,-6.81387],[39.2509061,-6.813907],[39.2506506,-6.8138297],[39.2505266,-6.8139398],[39.2503673,-6.8139328],[39.2502408,-6.8138977],[39.2499362,-6.8135087],[39.2496936,-6.8134724],[39.2495028,-6.8135077],[39.2491585,-6.8137102],[39.2489616,-6.8138813],[39.2485867,-6.8140804],[39.2484087,-6.8140874],[39.2481164,-6.8143121],[39.2477643,-6.8146518],[39.2475122,-6.814826],[39.2470384,-6.8150652],[39.2467424,-6.8152158],[39.2465532,-6.8153096],[39.2459771,-6.8157251],[39.245758,-6.8158849],[39.245222,-6.8159625],[39.2449786,-6.8160683],[39.244583,-6.8163899],[39.2444413,-6.8165876],[39.2442719,-6.8167623],[39.2436513,-6.81672],[39.2427859,-6.8168899],[39.2423186,-6.8170651],[39.2416906,-6.8171509],[39.2411664,-6.8169908],[39.2408813,-6.817016],[39.2403802,-6.8172851],[39.2397213,-6.8178586],[39.239207,-6.8181408],[39.2390455,-6.818145],[39.2389601,-6.8181496],[39.2384634,-6.8178175],[39.2383606,-6.8178263],[39.2378524,-6.8181197],[39.2374549,-6.8182514],[39.237168,-6.8185619],[39.2369304,-6.8185971],[39.2367514,-6.8185605],[39.2364546,-6.818694],[39.2361653,-6.8187014],[39.2358945,-6.8186346],[39.2356826,-6.8185003],[39.2355142,-6.8185029],[39.2350625,-6.8185861],[39.2349268,-6.8186886],[39.2348651,-6.8187407],[39.2345869,-6.8184625],[39.2342853,-6.8183713],[39.2337688,-6.8184941],[39.2334727,-6.8184724],[39.2332857,-6.8183897],[39.2332611,-6.8183788],[39.2330832,-6.8183001],[39.2324588,-6.817782],[39.2322293,-6.8176876],[39.2319288,-6.8177053],[39.2316235,-6.8178082],[39.230798,-6.8182868],[39.2299577,-6.81869],[39.2296182,-6.8187791],[39.2290452,-6.818673],[39.2283825,-6.8186629],[39.2278552,-6.8189536],[39.2269926,-6.8198409],[39.2273993,-6.8203036],[39.2283377,-6.8211915],[39.2283957,-6.821204],[39.2283353,-6.8212252],[39.2274068,-6.8213023],[39.2267957,-6.8212259],[39.2265621,-6.8210415],[39.2264793,-6.8210468],[39.2262799,-6.8211081],[39.2260337,-6.8213269],[39.2223463,-6.8184325],[39.2219255,-6.817915],[39.2218675,-6.8177514],[39.2211033,-6.8177471],[39.2196913,-6.8174457],[39.2190435,-6.8174683],[39.2187114,-6.8174171],[39.2173004,-6.817563],[39.2168675,-6.8175103],[39.2161911,-6.8175264],[39.2159829,-6.8176209],[39.2155521,-6.817485],[39.2151645,-6.8175467],[39.2150842,-6.8174536],[39.2147825,-6.8173454],[39.2143049,-6.8174776],[39.2139611,-6.8174001],[39.2137033,-6.8174197],[39.2126175,-6.8179079],[39.21085,-6.8177998],[39.2107064,-6.8178896],[39.2105653,-6.8181718],[39.2102139,-6.8183616],[39.2097419,-6.8184232],[39.2093879,-6.8185745],[39.2090724,-6.8190234],[39.2088236,-6.8195287],[39.2088159,-6.8198057],[39.2086954,-6.8200058],[39.2085851,-6.8200699],[39.2082852,-6.8200809],[39.2078668,-6.8199961],[39.2076585,-6.8200473],[39.207404,-6.820264],[39.2073098,-6.8202734],[39.2070459,-6.8205561],[39.2068386,-6.8206504],[39.2065182,-6.8205608],[39.2064334,-6.8206033],[39.206047,-6.8203253],[39.2057784,-6.820297],[39.2055947,-6.8202122],[39.2052224,-6.8197645],[39.204657,-6.8195666],[39.204379,-6.8194017],[39.2041529,-6.8193358],[39.2035827,-6.8193735],[39.2029937,-6.8190955],[39.2024472,-6.8189824],[39.2023388,-6.8190578],[39.20191,-6.8196562],[39.2011023,-6.8202749],[39.2009424,-6.8203282],[39.2006596,-6.8202544],[39.2004341,-6.8200863],[39.2000856,-6.8203241],[39.1999462,-6.8203651],[39.1998314,-6.8203241],[39.1993395,-6.8197706],[39.1993442,-6.8195735],[39.1992205,-6.8192833],[39.1990587,-6.8192405],[39.1988399,-6.8193975],[39.1986924,-6.8193309],[39.1985973,-6.8191502],[39.1984736,-6.8191169],[39.1983832,-6.8191406],[39.1982077,-6.8193547],[39.1981311,-6.8193214],[39.1980835,-6.8192072],[39.1979789,-6.8191882],[39.1976649,-6.8193166],[39.1974366,-6.8199493],[39.1974937,-6.8200587],[39.1974176,-6.8204678],[39.1971417,-6.8205868],[39.1970846,-6.8207247],[39.1966041,-6.8206534],[39.1961427,-6.8204298],[39.1957135,-6.8204353],[39.195374,-6.8203654],[39.1952043,-6.8202855],[39.1948598,-6.819946],[39.19469,-6.8198861],[39.1947599,-6.8197563],[39.1944732,-6.8188986],[39.1938513,-6.8183084],[39.1934918,-6.8182585],[39.1931873,-6.8181087],[39.1931473,-6.817889],[39.1929177,-6.8177542],[39.1925882,-6.8178641],[39.1923285,-6.8178391],[39.1920789,-6.8176943],[39.1915197,-6.8175445],[39.1908158,-6.8170103],[39.1907708,-6.8166309],[39.1908058,-6.8163513],[39.1904713,-6.8159569],[39.1901867,-6.8159918],[39.1898272,-6.8163962],[39.1894578,-6.816526],[39.1892381,-6.8165111],[39.1892231,-6.8163763],[39.189318,-6.8162864],[39.189283,-6.8161766],[39.1884193,-6.8153328],[39.1883794,-6.8150931],[39.1881597,-6.8150232],[39.1880748,-6.8147836],[39.1882296,-6.8146288],[39.1882745,-6.8144291],[39.1880698,-6.8140746],[39.1879207,-6.813605],[39.1877155,-6.8135112],[39.1872964,-6.8136006],[39.1872508,-6.8136944],[39.1868758,-6.813689],[39.1866587,-6.8139336],[39.1863324,-6.8137551],[39.1859836,-6.8139248],[39.1857929,-6.8139033],[39.1853738,-6.8136553],[39.1849195,-6.8135005],[39.1846056,-6.8131693],[39.1844881,-6.8132315],[39.1843705,-6.8134044],[39.1842876,-6.8133698],[39.1841216,-6.8131554],[39.1840525,-6.8129411],[39.1840179,-6.812547],[39.1838444,-6.8121174],[39.1837779,-6.8115549],[39.183614,-6.8113157],[39.1836096,-6.8108949],[39.1834679,-6.8107931],[39.1830446,-6.8107102],[39.1828477,-6.8102975],[39.1827061,-6.8102438],[39.1823384,-6.8102483],[39.1821308,-6.8101507],[39.1818386,-6.8101259],[39.1810056,-6.8097591],[39.180757,-6.8097902],[39.1805401,-6.8100622],[39.1803772,-6.8101589],[39.1802788,-6.8104476],[39.1801636,-6.8104697],[39.1800662,-6.8107],[39.179889,-6.8109126],[39.1795036,-6.8112271],[39.1795125,-6.8115195],[39.1792689,-6.8117321],[39.1787108,-6.8118782],[39.1784444,-6.8118727],[39.1779471,-6.8121773],[39.1775761,-6.8123214],[39.17753,-6.8125582],[39.1772933,-6.8126766],[39.1771223,-6.812841],[39.1769362,-6.8129024],[39.1767671,-6.8130844],[39.176605,-6.8130989],[39.1764514,-6.8133804],[39.1758574,-6.813481],[39.1757608,-6.8136106],[39.1753809,-6.8137712],[39.1751598,-6.813914],[39.1750899,-6.8140381],[39.1748711,-6.8140849],[39.1747609,-6.8141893],[39.1745811,-6.8140849],[39.1745543,-6.8142053],[39.1744651,-6.8142531],[39.1741635,-6.8142763],[39.1733748,-6.8149607],[39.1727832,-6.81521],[39.1726904,-6.815297],[39.1726093,-6.815529],[39.1724933,-6.8156102],[39.1712927,-6.816225],[39.1712232,-6.8166889],[39.1711014,-6.8168861],[39.1703184,-6.8174893],[39.1701386,-6.8181446],[39.1697711,-6.8184556],[39.1696734,-6.8187186],[39.1695594,-6.8186072],[39.1694539,-6.8187713],[39.1691336,-6.8189901],[39.1687274,-6.8193885],[39.1683407,-6.8198572],[39.1681336,-6.8199627],[39.1673133,-6.8201072],[39.1672508,-6.8201814],[39.167325,-6.820451],[39.1672899,-6.8206658],[39.1669657,-6.8208104],[39.1661844,-6.8209119],[39.1658407,-6.8211424],[39.1655712,-6.8212244],[39.1642504,-6.8210923],[39.1639341,-6.8209793],[39.1634208,-6.8206501],[39.1630981,-6.8205661],[39.1626092,-6.8201803],[39.1620967,-6.82094],[39.1620545,-6.8212053],[39.1620967,-6.8215188],[39.1619098,-6.8219409],[39.1615601,-6.8218143],[39.1611742,-6.8219831],[39.1607222,-6.8220106],[39.1600482,-6.8209082],[39.1598553,-6.8205042],[39.1597407,-6.820046],[39.1593963,-6.8200812],[39.1586564,-6.8198777],[39.1580291,-6.8196345],[39.1572899,-6.8197123],[39.1570808,-6.8198874],[39.156789,-6.8200284],[39.15622,-6.8201646],[39.1551356,-6.8201694],[39.1547271,-6.8205828],[39.1542528,-6.820698],[39.1531448,-6.820704],[39.1521753,-6.8205655],[39.1512678,-6.8206779],[39.1512023,-6.8205483],[39.1510519,-6.8205008],[39.1506391,-6.8204581],[39.1496085,-6.820175],[39.1497161,-6.820354],[39.1497727,-6.8212816],[39.1493202,-6.8224695],[39.1489582,-6.8229785],[39.1485941,-6.8233537],[39.1484328,-6.8230597],[39.1473908,-6.8237628],[39.1472194,-6.8242232],[39.1469746,-6.8255356],[39.1474006,-6.8275875],[39.147523,-6.8287285],[39.1475034,-6.8297667],[39.1473663,-6.8303984],[39.1469987,-6.8313262],[39.146817,-6.8319776],[39.1466973,-6.8321105],[39.1465954,-6.8321371],[39.1464802,-6.8324207],[39.1463428,-6.832496],[39.1461789,-6.8324916],[39.1460406,-6.8323801],[39.1459617,-6.8321282],[39.1458155,-6.8320662],[39.1455851,-6.8320795],[39.1452704,-6.8322036],[39.1451153,-6.8323941],[39.1449824,-6.8324207],[39.1448317,-6.8323587],[39.144588,-6.8320972],[39.1444861,-6.8321017],[39.1443927,-6.8322288],[39.1442927,-6.8322208],[39.1441451,-6.8320473],[39.1439628,-6.8319908],[39.143837,-6.8320776],[39.1436721,-6.8320212],[39.1436938,-6.8315135],[39.1435983,-6.8313702],[39.1433205,-6.8314701],[39.1433075,-6.8309319],[39.1432554,-6.8308581],[39.1430905,-6.8308798],[39.1428866,-6.8310274],[39.1425611,-6.8309449],[39.1420967,-6.8310447],[39.1419709,-6.8308234],[39.1418624,-6.8302158],[39.1414892,-6.829886],[39.1412114,-6.8297385],[39.139597,-6.8296083],[39.1388636,-6.8294911],[39.1383298,-6.8293349],[39.1375842,-6.8290177],[39.1372655,-6.8289503],[39.1370052,-6.8290266],[39.136866,-6.8293004],[39.1367763,-6.8293094],[39.1363317,-6.8291636],[39.1363274,-6.8292293],[39.1359596,-6.8292102],[39.1350808,-6.8288233],[39.1342291,-6.8290195],[39.1336956,-6.8289809],[39.1335451,-6.829039],[39.1333756,-6.8291976],[39.1325779,-6.8295893],[39.1322865,-6.8298472],[39.1322354,-6.83005],[39.1319492,-6.8304211],[39.1320055,-6.830655],[39.1321934,-6.8309522],[39.1321081,-6.8312844],[39.1320297,-6.8313546],[39.131981,-6.8316616],[39.1317689,-6.8322553],[39.13126,-6.8328384],[39.1304224,-6.8333155],[39.130062,-6.8337926],[39.1288035,-6.8342063],[39.1280819,-6.8346707],[39.1276958,-6.8344613],[39.1271439,-6.8343266],[39.127065,-6.8340726],[39.1267646,-6.8338668],[39.1259214,-6.8338491],[39.1250789,-6.8331883],[39.1250219,-6.8330759],[39.124683,-6.8324074],[39.1241425,-6.8315225],[39.1240292,-6.8312174],[39.1237459,-6.8311172],[39.1231269,-6.8312218],[39.1221418,-6.8307554],[39.1215578,-6.8307728],[39.1210682,-6.8306325],[39.1208922,-6.8304157],[39.1201717,-6.8320397],[39.1191078,-6.8357279],[39.1191752,-6.8359125],[39.1183079,-6.8367744],[39.1174673,-6.8380068],[39.1172547,-6.8384881],[39.1171613,-6.8390668],[39.1167693,-6.8402617],[39.1164892,-6.8415312],[39.1156864,-6.8425954],[39.1154437,-6.8430621],[39.1151823,-6.8438463],[39.1146596,-6.8447984],[39.1132407,-6.8461987],[39.1127179,-6.8463667],[39.1123819,-6.8467214],[39.1122897,-6.8475449],[39.1123866,-6.8479325],[39.1128387,-6.8486915],[39.1128226,-6.8497734],[39.1122735,-6.8512753],[39.1122823,-6.8516449],[39.1123294,-6.8521639],[39.1120959,-6.8524218],[39.1117568,-6.8533908],[39.1115145,-6.8544405],[39.1114008,-6.8546854],[39.1110947,-6.8553125],[39.110594,-6.8557324],[39.110368,-6.856346],[39.1098028,-6.8571535],[39.1097059,-6.8574764],[39.1097841,-6.8581347],[39.1093829,-6.8613845],[39.109399,-6.8624341],[39.1091568,-6.8635968],[39.1088015,-6.8648726],[39.1089953,-6.8660676],[39.1089469,-6.8674726],[39.1093183,-6.868716],[39.1102388,-6.8700564],[39.1106748,-6.870444],[39.1108847,-6.8711061],[39.1109332,-6.8718328],[39.1112723,-6.8726564],[39.1113702,-6.8732644],[39.1111492,-6.8732741],[39.111237,-6.8761091],[39.1109778,-6.8760642],[39.107955,-6.8760642],[39.1049975,-6.8756716],[39.1038983,-6.8754622],[39.1034181,-6.8754902],[39.1018031,-6.874745],[39.099444,-6.8737929],[39.0982036,-6.8735859],[39.0970844,-6.8741241],[39.0959253,-6.8750348],[39.0940624,-6.8755729],[39.0919512,-6.8757385],[39.0908749,-6.8756971],[39.0905437,-6.8754488],[39.0904195,-6.8737929],[39.0894674,-6.8735859],[39.0877287,-6.872965],[39.0857417,-6.8725096],[39.0846653,-6.872758],[39.0836304,-6.8720542],[39.0826783,-6.8713091],[39.0795637,-6.8693748],[39.0789921,-6.8693034],[39.0776348,-6.8693034],[39.0751345,-6.8687557],[39.0742772,-6.8684461],[39.0726341,-6.8681127],[39.071253,-6.8676841],[39.0711339,-6.8669459],[39.0704671,-6.8648504],[39.0703481,-6.8639455],[39.0690622,-6.8619214],[39.0687288,-6.8611118],[39.0684431,-6.8600164],[39.0680621,-6.857778],[39.0666333,-6.8551824],[39.0663012,-6.8542816],[39.0654351,-6.853585],[39.0649941,-6.853018],[39.0641121,-6.852766],[39.0635451,-6.852514],[39.0627892,-6.852451],[39.0619072,-6.852136],[39.0614662,-6.851758],[39.0605842,-6.851254],[39.0601432,-6.850246],[39.0592612,-6.849049],[39.0576232,-6.848041],[39.0572452,-6.8471591],[39.0565522,-6.8465291],[39.0543473,-6.8428751],[39.0541583,-6.8419931],[39.0546678,-6.8409879],[39.0552292,-6.8407961],[39.0563002,-6.8409851],[39.0576862,-6.8409851],[39.0585052,-6.8402291],[39.0588758,-6.839242],[39.0587572,-6.8374572],[39.0583792,-6.8365752],[39.0583162,-6.8353782],[39.0593872,-6.8342442],[39.0599388,-6.8329981],[39.0592612,-6.8315352],[39.0599073,-6.8302882],[39.0598282,-6.8293303],[39.0599542,-6.8273773],[39.0594502,-6.8254243],[39.0594593,-6.8250309],[39.0594879,-6.8247623],[39.0594547,-6.824172],[39.0583985,-6.8232539],[39.0582449,-6.8228907],[39.0584645,-6.8207685],[39.0583012,-6.8198887],[39.0581387,-6.8192733],[39.0576722,-6.8187146],[39.0573231,-6.8183095],[39.0572532,-6.8178207],[39.0574488,-6.8171503],[39.0578398,-6.81641],[39.0578486,-6.8159216],[39.0576024,-6.8153764],[39.0572532,-6.8150133],[39.056932,-6.8144546],[39.0566526,-6.8135328],[39.0556488,-6.8121336],[39.0551422,-6.8116336],[39.0541097,-6.8110621],[39.0530966,-6.8109127],[39.0525381,-6.8109127],[39.0521419,-6.8106919],[39.0518692,-6.8104517],[39.051525,-6.8097958],[39.0514341,-6.8093866],[39.0514276,-6.8090619],[39.05209,-6.8079709],[39.0521744,-6.8076592],[39.0521679,-6.807315],[39.052077,-6.8068734],[39.0518031,-6.8065032],[39.0512782,-6.8060032],[39.0512068,-6.8057889],[39.051512,-6.805068],[39.0518031,-6.8046524],[39.052038,-6.8038276],[39.0523562,-6.802308],[39.0524835,-6.8010876],[39.0524634,-6.8000124],[39.0525538,-6.7996708],[39.0529106,-6.7993492],[39.0532358,-6.7989267],[39.0534612,-6.7984554],[39.0536567,-6.7967514],[39.0536358,-6.7960042],[39.0535729,-6.7956829],[39.0532447,-6.7953757],[39.0527489,-6.7951592],[39.0525743,-6.7949846],[39.0525044,-6.794398],[39.0525184,-6.7938393],[39.0526231,-6.7930641],[39.0527489,-6.792282],[39.0528955,-6.7918979],[39.0531748,-6.7915138],[39.0536358,-6.7912344],[39.054128,-6.7900762],[39.049654,-6.7900179],[39.0483537,-6.7901247],[39.0460448,-6.7909279],[39.0449441,-6.7911464],[39.0416677,-6.7911363],[39.037439,-6.7917717],[39.0342393,-6.7919496],[39.023555,-6.7912786],[39.0213767,-6.790755],[39.0200815,-6.7904373],[39.0189911,-6.7903846],[39.018077,-6.7904605],[39.0141263,-6.7908517],[39.0113905,-6.7911227],[39.0098474,-6.7912338],[39.0092302,-6.7912153],[39.0087179,-6.7911598],[39.0071624,-6.7905796],[39.0070295,-6.7905427],[39.0071125,-6.7903553],[39.0072004,-6.7902752],[39.0073672,-6.7901661],[39.0076989,-6.7900041],[39.00773,-6.7899404],[39.0077135,-6.7898658],[39.0077209,-6.7897439],[39.0077758,-6.789662],[39.007785,-6.7895601],[39.0076401,-6.7893411],[39.0075238,-6.7892128],[39.0074577,-6.7890302],[39.0075075,-6.7889405],[39.0076879,-6.7889178],[39.0078198,-6.7889232],[39.0080049,-6.7890961],[39.0080837,-6.7891198],[39.0082523,-6.7890834],[39.0084667,-6.7889214],[39.0084887,-6.7887613],[39.0085363,-6.7886758],[39.0086701,-6.7886357],[39.0087141,-6.7885757],[39.0087287,-6.7884356],[39.0088167,-6.7883373],[39.0090091,-6.78827],[39.0093829,-6.7881372],[39.0095094,-6.7880207],[39.0095662,-6.787937],[39.0096615,-6.787715],[39.0096688,-6.7876022],[39.0096193,-6.7873893],[39.0097091,-6.7871764],[39.0097256,-6.7870727],[39.0096761,-6.7869471],[39.0096468,-6.7867378],[39.00961,-6.7865539],[39.0097088,-6.7863996],[39.0097582,-6.7861589],[39.0098446,-6.7859058],[39.0099303,-6.7856269],[39.0099433,-6.7855848],[39.0100297,-6.7853441],[39.0100915,-6.7849676],[39.0100915,-6.7847146],[39.0100957,-6.7843401],[39.0101245,-6.784262],[39.0101635,-6.7841819],[39.0102498,-6.7841531],[39.0104163,-6.7842189],[39.0105539,-6.7842415],[39.0105909,-6.7842004],[39.0106074,-6.7841593],[39.0106135,-6.7840935],[39.0105994,-6.7839705],[39.0105478,-6.7839148],[39.0105334,-6.7838552],[39.0105375,-6.783699],[39.0105827,-6.7836065],[39.010706,-6.7835922],[39.0108498,-6.7835942],[39.0110512,-6.7835963],[39.0112752,-6.7836435],[39.0113964,-6.7836517],[39.0115773,-6.7836743],[39.0117827,-6.7837442],[39.0119077,-6.7836802],[39.0119598,-6.7836202],[39.0119964,-6.7835387],[39.012054,-6.783455],[39.0121333,-6.7834144],[39.01222,-6.7833605],[39.0122712,-6.7833201],[39.0123223,-6.7833009],[39.0123749,-6.7832369],[39.0124171,-6.7831817],[39.0124351,-6.783119],[39.0123787,-6.7829655],[39.0123144,-6.7828935],[39.0122419,-6.7828296],[39.0121033,-6.7827396],[39.0120077,-6.7827215],[39.011945,-6.7827198],[39.0118866,-6.7827148],[39.0117829,-6.7826914],[39.0116716,-6.7825976],[39.0116006,-6.782477],[39.0115955,-6.7824616],[39.0115226,-6.7822429],[39.0115297,-6.7820478],[39.0115013,-6.781906],[39.0114942,-6.781718],[39.0116077,-6.7815123],[39.0116538,-6.7813669],[39.011707,-6.7812321],[39.0116964,-6.78103],[39.0116326,-6.7808349],[39.01159,-6.7806895],[39.0115423,-6.7805277],[39.0114552,-6.7804448],[39.0113169,-6.7804377],[39.0112176,-6.7805086],[39.0110935,-6.7805902],[39.0109694,-6.7806611],[39.0108098,-6.7807108],[39.0107523,-6.780716],[39.0107024,-6.7807254],[39.0106384,-6.7807361],[39.0105225,-6.7807569],[39.0103345,-6.7807604],[39.0101537,-6.7807782],[39.0100668,-6.7807835],[39.0099799,-6.7807888],[39.0098114,-6.7807982],[39.0097245,-6.780803],[39.0096826,-6.7807845],[39.0096048,-6.78075],[39.0094851,-6.7806971],[39.0095382,-6.7807635],[39.009581,-6.7809261],[39.0095887,-6.7809554],[39.0095786,-6.781218],[39.0095046,-6.7813496],[39.0094877,-6.7813796],[39.0094319,-6.7814206],[39.0093362,-6.7814907],[39.0089625,-6.7813897],[39.0089514,-6.7813822],[39.0088597,-6.7813203],[39.0085282,-6.7810968],[39.0082758,-6.7806221],[39.0080435,-6.7798747],[39.0079472,-6.7792814],[39.0079223,-6.7791273],[39.0081748,-6.7788041],[39.0082632,-6.7786715],[39.0083566,-6.7785314],[39.008512,-6.778368],[39.008858,-6.7780643],[39.009024,-6.7779266],[39.0092818,-6.7777147],[39.0095325,-6.7774816],[39.0096914,-6.7772627],[39.0098609,-6.7770756],[39.0100304,-6.7768884],[39.0102882,-6.7767048],[39.0105672,-6.7765106],[39.010892,-6.7762528],[39.0109487,-6.7762176],[39.0111428,-6.7760974],[39.0112699,-6.7760056],[39.0114676,-6.7759244],[39.0115785,-6.7758874],[39.0116496,-6.7758632],[39.0117045,-6.7758624],[39.0118208,-6.7758891],[39.0122163,-6.7760797],[39.0124352,-6.7761786],[39.01258,-6.7762492],[39.0126603,-6.7762748],[39.0128024,-6.7763199],[39.0132297,-6.7764187],[39.0134734,-6.7763905],[39.0135794,-6.7763689],[39.0136782,-6.7763481],[39.0138442,-6.7763234],[39.0141125,-6.7762775],[39.0143456,-6.7762846],[39.0146549,-6.7763436],[39.0146599,-6.7763446],[39.0146736,-6.7763448],[39.0148753,-6.7763481],[39.0150519,-6.7763552],[39.0151825,-6.776394],[39.0153979,-6.7764046],[39.0155957,-6.7763622],[39.0156605,-6.7763406],[39.0157758,-6.7763022],[39.0159402,-6.7762558],[39.0161748,-6.7761998],[39.0162843,-6.7761927],[39.0164184,-6.7762104],[39.0166091,-6.7763163],[39.0166771,-6.7764007],[39.0167115,-6.7764435],[39.0167746,-6.7764978],[39.0168139,-6.7765317],[39.0169497,-6.7766415],[39.0169799,-6.7766659],[39.0170092,-6.7766919],[39.0170159,-6.7766978],[39.0170765,-6.7767515],[39.0171353,-6.7768037],[39.0172942,-6.7768778],[39.0174849,-6.7769308],[39.0175919,-6.7769363],[39.0176226,-6.7769378],[39.0176596,-6.776936],[39.0177674,-6.7769308],[39.0179581,-6.7768708],[39.0181382,-6.7767648],[39.0181407,-6.7767529],[39.0181664,-6.7766342],[39.0181545,-6.7764931],[39.0181382,-6.7762987],[39.0181099,-6.7760762],[39.0180963,-6.7760107],[39.0180923,-6.7759915],[39.0180919,-6.7759633],[39.0180887,-6.7757337],[39.0181346,-6.7755854],[39.0183041,-6.7755253],[39.0185654,-6.7755854],[39.018689,-6.7756489],[39.0188585,-6.7757054],[39.0189927,-6.7757266],[39.0192929,-6.7757549],[39.0193882,-6.7757443],[39.0194836,-6.7757337],[39.0196813,-6.7755924],[39.0196871,-6.7755889],[39.0198148,-6.7755115],[39.0198967,-6.7754618],[39.0199779,-6.7753629],[39.0200239,-6.7752393],[39.0200305,-6.7751898],[39.020038,-6.7751334],[39.0200062,-6.7749568],[39.0199568,-6.7746284],[39.0198367,-6.7745119],[39.0196884,-6.7742718],[39.0196823,-6.7742483],[39.0196679,-6.774193],[39.019646,-6.7741093],[39.0196955,-6.7739928],[39.019819,-6.773901],[39.0199674,-6.7738657],[39.0201192,-6.7739186],[39.020211,-6.7740104],[39.0202509,-6.774052],[39.020377,-6.7741835],[39.0204829,-6.7743071],[39.0206418,-6.7743918],[39.0206577,-6.774398],[39.0206736,-6.7744042],[39.0207396,-6.7744132],[39.0209032,-6.7744355],[39.0210932,-6.7743293],[39.0211824,-6.7742779],[39.0212982,-6.7741359],[39.0213565,-6.7740592],[39.0215644,-6.7739443],[39.0215794,-6.773936],[39.0216814,-6.7738796],[39.0218524,-6.7736573],[39.0218933,-6.7735551],[39.0219333,-6.7734551],[39.0219551,-6.7734007],[39.0222971,-6.7731955],[39.0227409,-6.7732385],[39.0228273,-6.7732468],[39.0232463,-6.7730758],[39.0232584,-6.7730577],[39.0233489,-6.7729219],[39.0234858,-6.7726397],[39.0237423,-6.7724943],[39.0238057,-6.772477],[39.0240587,-6.7724515],[39.0242349,-6.7723844],[39.0245974,-6.7722463],[39.0250079,-6.7722121],[39.0253414,-6.7719727],[39.0254087,-6.771737],[39.0254782,-6.7714938],[39.0255202,-6.7714498],[39.0256578,-6.7713057],[39.025879,-6.77115],[39.0258887,-6.7711432],[39.0258994,-6.7711429],[39.0259442,-6.7711418],[39.0260782,-6.7711384],[39.0262308,-6.7711346],[39.0264959,-6.7712373],[39.0267438,-6.7713057],[39.0268175,-6.7713575],[39.0269747,-6.7714681],[39.0271055,-6.7715307],[39.0271714,-6.7715622],[39.0273852,-6.7715109],[39.0274971,-6.7713442],[39.0274707,-6.7710748],[39.0274237,-6.7709465],[39.0273767,-6.7708182],[39.0273463,-6.7707838],[39.0272374,-6.7706602],[39.0272115,-6.7704474],[39.0272056,-6.7703992],[39.0269893,-6.7703235],[39.0269669,-6.7703156],[39.0268636,-6.7702795],[39.0267578,-6.7701125],[39.0267546,-6.7701075],[39.0267011,-6.770023],[39.0267519,-6.7699614],[39.0269374,-6.7696915],[39.027026,-6.7696296],[39.0272056,-6.7695013],[39.0274964,-6.7693816],[39.0279239,-6.7692362],[39.0281634,-6.7688343],[39.0282897,-6.7683722],[39.0282917,-6.7680818],[39.0281719,-6.7678424],[39.0280864,-6.7675944],[39.0279325,-6.7671839],[39.0278641,-6.7668931],[39.0275757,-6.7666598],[39.0275562,-6.7662945],[39.0274622,-6.7658926],[39.0275648,-6.7656617],[39.0277529,-6.7654907],[39.0279411,-6.7653026],[39.0282575,-6.7653539],[39.0283002,-6.7655249],[39.028266,-6.7657558],[39.0282318,-6.7659696],[39.0282746,-6.7661321],[39.028437,-6.7661235],[39.028591,-6.7659696],[39.0287876,-6.7657473],[39.0290869,-6.7657729],[39.0292323,-6.7660551],[39.0293264,-6.7663117],[39.0294632,-6.766534],[39.0297283,-6.7665767],[39.0300019,-6.7661406],[39.0301815,-6.76579],[39.0304259,-6.7660785],[39.0306765,-6.7662586],[39.0310211,-6.7662821],[39.0312403,-6.7658279],[39.0311941,-6.7655045],[39.0310612,-6.7654591],[39.0308277,-6.7652744],[39.0307082,-6.7652473],[39.0304855,-6.7651006],[39.0302466,-6.7649214],[39.0301542,-6.7648508],[39.0299261,-6.7646607],[39.0298718,-6.7645087],[39.0297849,-6.764324],[39.0297578,-6.7640796],[39.0297252,-6.7637375],[39.029861,-6.7635582],[39.0299805,-6.7635745],[39.0302086,-6.7635582],[39.0303009,-6.7634333],[39.0304204,-6.7633138],[39.0304964,-6.7631455],[39.0306159,-6.7629663],[39.0307245,-6.7626947],[39.0307788,-6.7623906],[39.0307354,-6.762081],[39.0307191,-6.7618909],[39.0305833,-6.7616574],[39.0304584,-6.7615053],[39.0302846,-6.7613261],[39.030214,-6.7611089],[39.0301434,-6.7608699],[39.0302303,-6.760745],[39.0303303,-6.7606148],[39.030369,-6.7605531],[39.0303837,-6.7604829],[39.0303769,-6.7604354],[39.03029,-6.7602453],[39.0302602,-6.7601856],[39.0302031,-6.7600715],[39.0300185,-6.7598652],[39.0298483,-6.7598311],[39.0297741,-6.7598163],[39.0295243,-6.7598],[39.0294102,-6.7598217],[39.0292093,-6.7598815],[39.0289975,-6.7599629],[39.0287752,-6.7600486],[39.028678,-6.760067],[39.0284492,-6.760194],[39.0280917,-6.7603336],[39.0278777,-6.7603575],[39.0277767,-6.7603196],[39.02771,-6.7602542],[39.0276343,-6.7601693],[39.0276451,-6.7598978],[39.0277768,-6.7597845],[39.0278569,-6.7596425],[39.0279601,-6.7593438],[39.0278732,-6.7591591],[39.0278678,-6.7588876],[39.027933,-6.7587681],[39.0280416,-6.7586758],[39.0281285,-6.7585617],[39.0281774,-6.7584585],[39.0282154,-6.7582739],[39.0282751,-6.7580784],[39.0283294,-6.757948],[39.0284163,-6.7577471],[39.0284685,-6.7576819],[39.0284582,-6.7575834],[39.0285063,-6.7572723],[39.0285516,-6.7570522],[39.0287486,-6.7566801],[39.0287865,-6.7564941],[39.028858,-6.7561439],[39.0289488,-6.7560677],[39.0290259,-6.756003],[39.0291316,-6.7559141],[39.0295365,-6.7556624],[39.0297059,-6.755479],[39.0299195,-6.7552247],[39.0299941,-6.75511],[39.0300618,-6.7550059],[39.030129,-6.7547973],[39.0301576,-6.7546173],[39.0301413,-6.7543802],[39.0301126,-6.7541757],[39.0301658,-6.7538854],[39.0303416,-6.7536769],[39.0305297,-6.7535788],[39.0305703,-6.7535702],[39.0306851,-6.7535461],[39.0308691,-6.7535951],[39.031094,-6.753591],[39.0313107,-6.753681],[39.0315969,-6.7536401],[39.0317482,-6.7535461],[39.0318872,-6.7534234],[39.0320508,-6.7531903],[39.0322304,-6.7529],[39.0322746,-6.7527555],[39.0322968,-6.7525635],[39.0324297,-6.7521353],[39.032533,-6.75184],[39.0326023,-6.7517451],[39.0327283,-6.7515213],[39.0327998,-6.7513968],[39.0328726,-6.7512715],[39.0330129,-6.7509614],[39.0331858,-6.7506668],[39.0332423,-6.750582],[39.0333117,-6.7505151],[39.0334017,-6.7503531],[39.0335149,-6.750222],[39.0336383,-6.7500883],[39.0337565,-6.7500986],[39.0338722,-6.7500755],[39.0339879,-6.750006],[39.0340934,-6.7499263],[39.0342219,-6.7498363],[39.0343788,-6.7497746],[39.0344636,-6.7496975],[39.0346153,-6.7496435],[39.0348158,-6.7495895],[39.0349753,-6.7495792],[39.0351912,-6.7495844],[39.0352658,-6.7495664],[39.0353815,-6.7495175],[39.035474,-6.7493993],[39.0355538,-6.7493298],[39.0356669,-6.7492321],[39.0357054,-6.7491846],[39.035744,-6.749137],[39.035799,-6.749068],[39.0358844,-6.748903],[39.0359218,-6.7486535],[39.0359312,-6.7485163],[39.0359205,-6.7484191],[39.0358633,-6.7482931],[39.0357253,-6.7480751],[39.0354817,-6.7479152],[39.0353393,-6.7476949],[39.0352224,-6.7474378],[39.0351691,-6.7472696],[39.0351566,-6.7470791],[39.0352745,-6.7467609],[39.0354218,-6.7466077],[39.0355927,-6.7464869],[39.0357636,-6.7464338],[39.0358923,-6.7464314],[39.0360288,-6.7464102],[39.0362798,-6.746433],[39.0364649,-6.7464397],[39.0365857,-6.7465075],[39.0367174,-6.7465321],[39.0367861,-6.7465694],[39.0368556,-6.746648],[39.0369481,-6.7466776],[39.0370297,-6.7466931],[39.0371458,-6.7466542],[39.0372782,-6.746643],[39.037452,-6.7467815],[39.0376023,-6.7468581],[39.0377496,-6.746976],[39.0378763,-6.7470732],[39.0380148,-6.7471174],[39.0381209,-6.7471292],[39.0382476,-6.7470703],[39.0382995,-6.7469705],[39.0382783,-6.7469083],[39.0382571,-6.7468461],[39.038227,-6.7467579],[39.0382505,-6.7466961],[39.0383183,-6.7465664],[39.0384273,-6.7464721],[39.0386395,-6.7463602],[39.0389583,-6.7462663],[39.0391699,-6.7462718],[39.0393377,-6.7462053],[39.0395853,-6.7461657],[39.039877,-6.7460272],[39.0398628,-6.74573],[39.0401074,-6.745348],[39.0402588,-6.7452447],[39.0403734,-6.7451591],[39.0407698,-6.7450519],[39.0409467,-6.7447587],[39.0409807,-6.7447181],[39.040989,-6.7445438],[39.0409719,-6.7443402],[39.0409635,-6.7442395],[39.0409496,-6.7440736],[39.0409696,-6.7438957],[39.0409584,-6.7437584],[39.0409908,-6.7436051],[39.0410733,-6.743558],[39.0411588,-6.7435845],[39.0412295,-6.7435845],[39.041312,-6.7435462],[39.0413768,-6.7435226],[39.0414416,-6.7434696],[39.0415153,-6.7434578],[39.0416715,-6.7434519],[39.0417952,-6.7434578],[39.0419308,-6.7434431],[39.041977,-6.7434567],[39.0420918,-6.7434781],[39.0421389,-6.7434755],[39.0422216,-6.7434766],[39.0423146,-6.7435052],[39.0424243,-6.7434875],[39.0425775,-6.7434903],[39.0426659,-6.7434572],[39.0427713,-6.7434217],[39.0429054,-6.7433952],[39.0430882,-6.7433001],[39.0432831,-6.7433127],[39.0434394,-6.7432278],[39.0436173,-6.7431246],[39.0436898,-6.7430674],[39.0437921,-6.7429388],[39.0438251,-6.7427292],[39.0438494,-6.7425751],[39.0437881,-6.7424035],[39.0436946,-6.7422213],[39.0436836,-6.7420208],[39.0437574,-6.741957],[39.04377,-6.7418328],[39.0438628,-6.741755],[39.0442325,-6.74144],[39.0443932,-6.7411164],[39.0444501,-6.7407689],[39.0443676,-6.7405861],[39.044129,-6.7399297],[39.0440881,-6.7396996],[39.0440094,-6.739406],[39.04408,-6.7393111],[39.0441187,-6.739265],[39.0443657,-6.7390907],[39.0447615,-6.7388795],[39.0453868,-6.7385812],[39.0455372,-6.7385095],[39.046147,-6.7382693],[39.0463249,-6.7381992],[39.0468142,-6.7381038],[39.0471603,-6.7379009],[39.0471125,-6.737507],[39.0466352,-6.73697],[39.0460027,-6.7368268],[39.0457878,-6.7365165],[39.0458714,-6.7359078],[39.0461459,-6.7355737],[39.0462594,-6.7353933],[39.0462708,-6.7353753],[39.0463488,-6.7352514],[39.0462791,-6.7350768],[39.0461817,-6.7348934],[39.0456446,-6.734607],[39.045394,-6.7341535],[39.0452985,-6.7336284],[39.0454656,-6.7330794],[39.0457461,-6.7328765],[39.0460265,-6.7326736],[39.0468142,-6.732423],[39.0477928,-6.7321485],[39.0487595,-6.7318382],[39.0493204,-6.7316234],[39.0495472,-6.7315399],[39.0500717,-6.7312781],[39.0504426,-6.7309205],[39.0505206,-6.7306585],[39.0505287,-6.7305231],[39.0506148,-6.7301258],[39.0505353,-6.7298675],[39.0504559,-6.7296092],[39.0502291,-6.7294259],[39.0495713,-6.728522],[39.0495155,-6.7284304],[39.0496413,-6.728033],[39.0496855,-6.7278934],[39.0497221,-6.7277778],[39.0497671,-6.7276357],[39.0499658,-6.7275231],[39.0501399,-6.7274244],[39.0501717,-6.7274126],[39.0502033,-6.7273828],[39.0502803,-6.7273414],[39.0503812,-6.7272994],[39.0506752,-6.7273147],[39.0508434,-6.7271989],[39.0511022,-6.7270768],[39.0515023,-6.7268674],[39.0518313,-6.7266501],[39.052138,-6.7264171],[39.052235,-6.7262372],[39.0523082,-6.7260432],[39.0522806,-6.7258496],[39.052215,-6.725717],[39.0521089,-6.7256592],[39.0519354,-6.7256945],[39.0516744,-6.7255694],[39.0515155,-6.7249601],[39.0517237,-6.7246271],[39.0517826,-6.7245469],[39.0519791,-6.7242184],[39.0528665,-6.7235429],[39.0531916,-6.7233214],[39.0540719,-6.7227216],[39.054946,-6.7219534],[39.0557049,-6.7215249],[39.0560252,-6.721344],[39.0560719,-6.7213176],[39.0560835,-6.7213178],[39.0566707,-6.7213253],[39.0569078,-6.7213284],[39.057105,-6.7213309],[39.0575793,-6.72183],[39.057562,-6.722167],[39.0574539,-6.7224797],[39.0574626,-6.7227249],[39.0575357,-6.7229069],[39.0576585,-6.7230014],[39.0577523,-6.7230487],[39.0580553,-6.7230433],[39.0582813,-6.72317],[39.0586692,-6.7232054],[39.0589981,-6.7230408],[39.0593075,-6.7228082],[39.0596945,-6.7222316],[39.0597955,-6.7220589],[39.0602219,-6.7211645],[39.0605456,-6.7208749],[39.0609392,-6.7205225],[39.0608134,-6.7200447],[39.0606548,-6.7197415],[39.0606548,-6.7189467],[39.0605356,-6.7179798],[39.0605886,-6.7174633],[39.0605513,-6.7171239],[39.0604976,-6.7166345],[39.0604694,-6.7163771],[39.0604451,-6.716355],[39.060019,-6.7159665],[39.0597033,-6.7158709],[39.0591448,-6.7157016],[39.0582574,-6.7154367],[39.0578479,-6.7152053],[39.0576481,-6.7150923],[39.0576358,-6.71508],[39.0575647,-6.7150535],[39.0575816,-6.714991],[39.0575961,-6.7149238],[39.0576297,-6.7148448],[39.0576545,-6.7147888],[39.0576649,-6.7146926],[39.0576407,-6.7146587],[39.0576831,-6.7144992],[39.0576269,-6.7143565],[39.0578176,-6.7139394],[39.0578771,-6.7127518],[39.058294,-6.7117268],[39.0585179,-6.7114602],[39.0592626,-6.7110902],[39.0594392,-6.7109193],[39.0598217,-6.7107859],[39.0604585,-6.7104966],[39.0609064,-6.7102419],[39.0614225,-6.7099448],[39.0616332,-6.7091137],[39.0614506,-6.7078792],[39.0612112,-6.7071731],[39.0608382,-6.7062361],[39.0609133,-6.7060296],[39.060975,-6.705975],[39.0608076,-6.705671],[39.0605968,-6.7053623],[39.0605405,-6.7051519],[39.0605792,-6.7050209],[39.0605538,-6.7048535],[39.0605056,-6.7045871],[39.060527,-6.7044379],[39.0603715,-6.7040623],[39.0602749,-6.7035881],[39.0603407,-6.7032492],[39.0605297,-6.7029515],[39.0606239,-6.7026681],[39.0606941,-6.7025655]]]]}}]};
  }

  // --- 2) zoom FIRST using bbox (most reliable) ---
  try{
    const bb = bboxFromGeoJSON(ubungoGeoJSON);
    if(bb){
      const rect = Cesium.Rectangle.fromDegrees(bb.minLon, bb.minLat, bb.maxLon, bb.maxLat);
      // add a little padding by expanding the rectangle slightly
      const padLon = (bb.maxLon - bb.minLon) * 0.12;
      const padLat = (bb.maxLat - bb.minLat) * 0.12;
      const rectPad = Cesium.Rectangle.fromDegrees(
        bb.minLon - padLon, bb.minLat - padLat, bb.maxLon + padLon, bb.maxLat + padLat
      );
      viewer.camera.flyTo({ destination: rectPad, duration: 2.6 });
    }
  }catch(e){ console.error(e); }

  // --- 3) draw in Cesium (red outline) ---
  try{
    ubungoDataSource = await Cesium.GeoJsonDataSource.load(ubungoGeoJSON, {
      stroke: Cesium.Color.RED,
      fill: Cesium.Color.RED.withAlpha(0.0),
      strokeWidth: 3,
      clampToGround: true
    });
    viewer.dataSources.add(ubungoDataSource);

    // label (optional)
    try{
      const ents = ubungoDataSource.entities.values || [];
      if(ents.length){
        const e = ents[0];
        e.name = 'Ubungo Municipal';
        e.description = '<b>Ubungo Municipal</b><br/>Study area boundary.';
        e.label = new Cesium.LabelGraphics({
          text: 'Ubungo',
          font: '18px sans-serif',
          fillColor: Cesium.Color.WHITE,
          outlineColor: Cesium.Color.BLACK,
          outlineWidth: 3,
          style: Cesium.LabelStyle.FILL_AND_OUTLINE,
          verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
          pixelOffset: new Cesium.Cartesian2(0, -10),
          distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0.0, 2.0e6)
        });
      }
    }catch(e){}
  }catch(e){ console.error(e); }

  // --- 4) also draw in Leaflet (2D) if map exists ---
  try{ ensureLeafletUbungoBoundary(ubungoGeoJSON); }catch(e){}
}


// Start loading Ubungo immediately (globe)
loadUbungoBoundary();
// Place search (Nominatim)
async function geocodePlace(q){
  const url = 'https://nominatim.openstreetmap.org/search?format=json&limit=1&q=' + encodeURIComponent(q);
  const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
  if(!res.ok) throw new Error('Geocoding failed: ' + res.status);
  const json = await res.json();
  return json && json.length ? json[0] : null;
}

async function runSearch(){
  const input = document.getElementById('placeSearch');
  const q = (input.value || '').trim();
  if(!q) return;
  setStatus('Searching‚Ä¶');
  try{
    const hit = await geocodePlace(q);
    if(!hit){
      setStatus('Not found');
      return;
    }
    const lon = Number(hit.lon);
    const lat = Number(hit.lat);

    const pin = viewer.entities.add({
      position: Cesium.Cartesian3.fromDegrees(lon, lat),
      point: { pixelSize: 10, color: Cesium.Color.CYAN, outlineColor: Cesium.Color.BLACK, outlineWidth: 2 },
      label: { text: hit.display_name, font: '14px sans-serif', fillColor: Cesium.Color.WHITE, outlineColor: Cesium.Color.BLACK, outlineWidth: 3, style: Cesium.LabelStyle.FILL_AND_OUTLINE, pixelOffset: new Cesium.Cartesian2(0, -18), distanceDisplayCondition: new Cesium.DistanceDisplayCondition(0.0, 5.0e6) }
    });

    viewer.flyTo(pin, { duration: 2.6 });
    setStatus('Esri + Overlays');
  }catch(e){
    console.error(e);
    setStatus('Search error');
  }
}
const _searchBtn = document.getElementById('searchBtn');
const _placeSearch = document.getElementById('placeSearch');
if(_searchBtn) _searchBtn.addEventListener('click', runSearch);
if(_placeSearch) _placeSearch.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') runSearch(); });
/* ============ Leaflet 2D Map ============ */
const map = L.map('map').setView([-6.79,39.25],12);

// Basemaps (switchable)
const baseImagery = L.tileLayer(
  'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, Maxar, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN' }
);

const baseStreets = L.tileLayer(
  'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
  { attribution: '¬© OpenStreetMap contributors' }
);

let activeBasemap = baseImagery;
window.activeBasemap = activeBasemap;
activeBasemap.addTo(map);

// Ubungo boundary on 2D map is added after GeoJSON loads (see loadUbungoBoundary())
if(ubungoGeoJSON){ ensureLeafletUbungoBoundary(ubungoGeoJSON); }
// Scale bar (metric only)

// Legend (bottom-right) + toggle
const legendEl = document.getElementById('mapLegend');
const legendBody = document.getElementById('legendBody');
const legendToggle = document.getElementById('legendToggle');
if(legendToggle && legendEl){
  legendToggle.addEventListener('click', ()=>{
    legendEl.classList.toggle('collapsed');
  });
}

// ============ Atlas Settings panel wiring ============

// ============ Atlas Settings: Search + Labels/Borders ============
const atlasToggleLabels = document.getElementById('atlasToggleLabels');
const atlasToggleBorders = document.getElementById('atlasToggleBorders');

// Wire Labels/Borders toggles to Cesium overlay layers if they exist
function atlasApplyOverlays(){
  try{
    const showLabels = atlasToggleLabels ? !!atlasToggleLabels.checked : true;
    const showBorders = atlasToggleBorders ? !!atlasToggleBorders.checked : true;

    // Cesium overlays (globe)
    if(typeof labelsLayer !== 'undefined' && labelsLayer) labelsLayer.show = showLabels;
    if(typeof bordersLayer !== 'undefined' && bordersLayer) bordersLayer.show = showBorders;

    // Leaflet borders (Ubungo boundary on 2D map)
    if(typeof ubungoLayer !== 'undefined' && ubungoLayer && typeof map !== 'undefined'){
      const hasUbungo = map.hasLayer(ubungoLayer);
      if(showBorders && !hasUbungo){
        ubungoLayer.addTo(map);
      }else if(!showBorders && hasUbungo){
        map.removeLayer(ubungoLayer);
      }
    }

    // "OSM labels" on the 2D map -> Streets basemap
    // When labels are turned OFF, force basemap back to Imagery so OSM streets/labels disappear.
    if(typeof setBasemap === 'function'){
      if(!showLabels){
        if(typeof basemapSel !== 'undefined' && basemapSel){
          if(basemapSel.value === 'streets'){
            basemapSel.value = 'imagery';
            setBasemap('imagery');
          }
        }else if(typeof activeBasemap !== 'undefined' && typeof baseStreets !== 'undefined' && activeBasemap === baseStreets){
          setBasemap('imagery');
        }
      }
      // When labels are ON we don't force any basemap; user chooses via Basemap dropdown.
    }

  }catch(e){}
}

// Keep initial state consistent with whatever the real toggles are (if present)
try{
  const tL = document.getElementById('toggleLabels');
  const tB = document.getElementById('toggleBorders');
  if(tL && atlasToggleLabels) atlasToggleLabels.checked = !!tL.checked;
  if(tB && atlasToggleBorders) atlasToggleBorders.checked = !!tB.checked;
}catch(e){}

if(atlasToggleLabels) atlasToggleLabels.addEventListener('change', ()=>{
  // also sync the hidden home toggle if present
  const tL = document.getElementById('toggleLabels');
  if(tL) tL.checked = atlasToggleLabels.checked;
  atlasApplyOverlays();
});
if(atlasToggleBorders) atlasToggleBorders.addEventListener('change', ()=>{
  const tB = document.getElementById('toggleBorders');
  if(tB) tB.checked = atlasToggleBorders.checked;
  atlasApplyOverlays();
});

atlasApplyOverlays();


// ============ Atlas Settings actions (Search / Scale / Metadata / Export) ============
const atlasMetaBtn = document.getElementById('atlasMetaBtn');
const atlasExportBtn = document.getElementById('atlasExportBtn');
const atlasToggleSearch = document.getElementById('atlasToggleSearch');
const atlasToggleScale  = document.getElementById('atlasToggleScale');
const atlasCurrentLayerName = document.getElementById('atlasCurrentLayerName');

// Map search panel + geocoding (Leaflet)
const mapSearchPanel = document.getElementById('mapSearchPanel');
const mapEl = document.getElementById('map');
if(mapEl && mapSearchPanel && mapSearchPanel.parentElement !== mapEl){
  mapEl.appendChild(mapSearchPanel);
}
const atlasSearchInput = document.getElementById('atlasSearchInput');
const atlasSearchGo = document.getElementById('atlasSearchGo');
let atlasSearchMarker = null;

function setSearchPanelVisible(on){
  if(!mapSearchPanel) return;
  mapSearchPanel.style.display = on ? 'block' : 'none';
}

async function runAtlasGeocode(){
  const q = (atlasSearchInput?.value || '').trim();
  if(!q){ toast('Type a place to search', 'info', 1800); return; }

  toast('Searching‚Ä¶', 'info', 1200);
  try{
    // Add a small context to improve results for local places
    const query = q;
    const url = 'https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=1&q=' + encodeURIComponent(query);
    const res = await fetch(url, { headers: { 'Accept': 'application/json' } });
    if(!res.ok) throw new Error('Search failed');
    const arr = await res.json();
    if(!arr || !arr.length){
      toast('No results found', 'error', 2200);
      return;
    }

    const hit = arr[0];
    const lat = parseFloat(hit.lat), lon = parseFloat(hit.lon);
    if(!Number.isFinite(lat) || !Number.isFinite(lon)) throw new Error('Bad result');

    // Smooth zoom to the place (prefer bounding box when available)
    const bb = hit.boundingbox;
    if(bb && bb.length === 4){
      const south = parseFloat(bb[0]), north = parseFloat(bb[1]);
      const west  = parseFloat(bb[2]), east  = parseFloat(bb[3]);
      if([south,north,west,east].every(Number.isFinite)){
        const bounds = L.latLngBounds([south, west], [north, east]);
        map.flyToBounds(bounds, { padding: [40, 40], maxZoom: 16, duration: 1.1 });
      }else{
        map.flyTo([lat, lon], Math.max(map.getZoom(), 15), { duration: 1.1 });
      }
    }else{
      map.flyTo([lat, lon], Math.max(map.getZoom(), 15), { duration: 1.1 });
    }

    // Drop a marker (replace previous)
    if(atlasSearchMarker){ try{ map.removeLayer(atlasSearchMarker); }catch(e){} }
    atlasSearchMarker = L.marker([lat, lon]).addTo(map);

    const name = (hit.display_name || q);
    atlasSearchMarker.bindPopup('<b>' + name + '</b>').openPopup();
    toast('Zoomed to: ' + q, 'success', 1800);
  }catch(e){
    console.error(e);
    toast('Search error', 'error', 2600);
  }
}

if(atlasSearchGo) atlasSearchGo.addEventListener('click', runAtlasGeocode);
if(atlasSearchInput) atlasSearchInput.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') runAtlasGeocode(); });

if(atlasToggleSearch){
  atlasToggleSearch.addEventListener('change', ()=>{
    setSearchPanelVisible(!!atlasToggleSearch.checked);
  });
  // default off
  setSearchPanelVisible(!!atlasToggleSearch.checked);
}

// Scale bar (bottom-left) toggle
let scaleControl = null;
function setScaleBarVisible(on){
  if(on){
    if(!scaleControl){
      scaleControl = L.control.scale({ position:'bottomleft', metric:true, imperial:false });
    }
    try{ scaleControl.addTo(map); }catch(e){}
  }else{
    if(scaleControl){
      try{ scaleControl.remove(); }catch(e){ try{ map.removeControl(scaleControl); }catch(_){} }
    }
  }
}
if(atlasToggleScale){
  atlasToggleScale.addEventListener('change', ()=> setScaleBarVisible(!!atlasToggleScale.checked));
  // default off
  setScaleBarVisible(!!atlasToggleScale.checked);
}

// ===== Layer-aware metadata =====
let layerMetaModal = document.getElementById('layerMetaModal');
let layerMetaClose = document.getElementById('layerMetaClose');
let layerMetaBody = document.getElementById('layerMetaBody');
let layerMetaTitle = document.getElementById('layerMetaTitle');

const layerMetadata = {
  // =========================
  // Landcover / Landuse
  // =========================
  landcover_map: {
    Theme: "Landcover",
    Source: "Sentinel-2",
    Date: "2020, 2025",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster",
    Notes: "Landcover classification for Ubungo District.",
    spatial_resolution: "10 m"
  },
  landcover_change_map: {
    Theme: "Landcover change",
    Source: "Sentinel-2",
    Date: "2020‚Äì2025",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster",
    Notes: "Shows changes between 2020 and 2025.",
    spatial_resolution: "10 m",
    temporal_resolution: "Event-based (multi-year comparison)"
  },

  // =========================
  // Transport / Roads
  // =========================
  road_network_map: {
    Theme: "Transport infrastructure",
    Source: "OpenStreetMap (OSM)",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector lines",
    Notes: "Road network including hierarchy (primary/secondary/tertiary)."
  },
  transport_network_map: {
    Theme: "Transport network",
    Source: "OpenStreetMap (OSM)",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector lines / routes",
    Notes: "Transport routes/network (e.g., bus routes)."
  },

  // =========================
  // Water supply / Boreholes
  // =========================
  water_supply_network: {
    Theme: "Water supply",
    Source: "DAWASA",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector lines",
    Notes: "Pipe network and related infrastructure."
  },
  boreholes_map_service_areas: {
    Theme: "Water resources",
    Source: "Utility records",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector points + polygons",
    Notes: "Borehole locations and derived service areas."
  },

  // =========================
  // Climate: Rainfall / Temperature / LST
  // =========================
  rainfall_map: {
    Theme: "Climate (Rainfall)",
    Source: "TerraClimate",
    Date: "2000‚Äì2024",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster",
    spatial_resolution: "4638.3 m",
    temporal_resolution: "Monthly",
    Data_Availability: "1958-01-01‚Äì2024-12-01"
  },

  air_temperature_map: {
    Theme: "Climate (Air temperature)",
    Source: "TerraClimate",
    Date: "2000‚Äì2024",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster",
    Notes: "Air temperature distribution.",
    spatial_resolution: "4638.3 m",
    temporal_resolution: "Monthly",
    Data_Availability: "1958-01-01‚Äì2024-12-01"
  },

  lst_map: {
    Theme: "Climate (Land Surface Temperature)",
    Source: "MODIS",
    Date: "2000‚Äì2024",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster",
    Notes: "LST spatial distribution.",
    spatial_resolution: "1000 m",
    temporal_resolution: "Monthly",
    Data_Availability: "2000-02-24‚Äì2026-01-01"
  },

  ndvi_3yrs: {
    Theme: "Vegetation (NDVI)",
    Source: "MODIS",
    Date: "2022, 2023, 2024",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster",
    Notes: "NDVI for three consecutive years.",
    spatial_resolution: "1000 m",
    temporal_resolution: "Monthly",
    Data_Availability: "2000-02-24‚Äì2026-01-01"
  },

  // =========================
  // Topography / Terrain
  // =========================
  topographic_map: {
    Theme: "Topography",
    Source: "To be provided (e.g., SRTM/ALOS DEM + contours)",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster + contours (vector)",
    Notes: "Elevation/contours/hillshade. Mention DEM source and vertical units.",
    spatial_resolution: "To be provided (e.g., 30 m)"
  },
  terrain_surface_analysis: {
    Theme: "Terrain analysis",
    Source: "To be provided (derived from DEM)",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster",
    Notes: "Derived surfaces (slope, aspect, curvature, hillshade, flow accumulation, etc.). List included outputs.",
    spatial_resolution: "Same as DEM"
  },

  // =========================
  // Public services
  // =========================
  police_stations_map: {
    Theme: "Public safety",
    Source: "To be provided (government/field survey/OSM)",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector points",
    Notes: "Police station locations. Include attribute info (name/level/contact) if available."
  },
  public_health_centres_map: {
    Theme: "Health services",
    Source: "To be provided",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector points",
    Notes: "Public health centres/clinics/hospitals. Define what counts as a health centre."
  },
  public_primary_schools_map: {
    Theme: "Education",
    Source: "To be provided",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector points",
    Notes: "Public primary schools. Add data completeness notes if needed."
  },
  public_secondary_schools_map: {
    Theme: "Education",
    Source: "To be provided",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Vector points",
    Notes: "Public secondary schools. Add data completeness notes if needed."
  },

  // =========================
  // Population
  // =========================
  population_distribution: {
    Theme: "Population",
    Source: "To be provided (e.g., census / WorldPop)",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster / polygons",
    Notes: "Population distribution for a stated year/period. State population measure and year.",
    spatial_resolution: "To be provided"
  },
  population_density: {
    Theme: "Population",
    Source: "To be provided (derived from population + area)",
    Date: "To be provided",
    CRS: "WGS 84 (EPSG:4326)",
    Format: "Raster / polygons",
    Notes: "Population density (people/km¬≤). State computation method and year.",
    spatial_resolution: "To be provided"
  }
};

// Map UI layer keys -> metadata keys (fixes mismatch like "rainfall" vs "rainfall_map")
const layerMetaAliases = {
  // climate
  rainfall: "rainfall_map",
  pr: "rainfall_map",
  rainfall_map: "rainfall_map",
  air_temperature: "air_temperature_map",
  airtemperature: "air_temperature_map",
  at: "air_temperature_map",
  temperature: "air_temperature_map",
  lst: "lst_map",
  lst_map: "lst_map",
  ndvi: "ndvi_3yrs",
  ndvi_3yrs: "ndvi_3yrs",

  // land
  landcover: "landcover_map",
  landcover_map: "landcover_map",
  landcover_change: "landcover_change_map",
  landcover_change_map: "landcover_change_map",

  // networks
  road: "road_network_map",
  roads: "road_network_map",
  road_network: "road_network_map",
  road_network_map: "road_network_map",
  transport: "transport_network_map",
  transport_network: "transport_network_map",
  transport_network_map: "transport_network_map",
  water_supply: "water_supply_network",
  water_supply_network: "water_supply_network",
  boreholes: "boreholes_map_service_areas",
  borehole: "boreholes_map_service_areas",
  boreholes_map_service_areas: "boreholes_map_service_areas",

  // terrain/topo
  topo: "topographic_map",
  topographic: "topographic_map",
  topographic_map: "topographic_map",
  terrain: "terrain_surface_analysis",
  terrain_surface_analysis: "terrain_surface_analysis",

  // services
  police: "police_stations_map",
  police_stations: "police_stations_map",
  police_stations_map: "police_stations_map",
  health: "public_health_centres_map",
  public_health_centres: "public_health_centres_map",
  public_health_centres_map: "public_health_centres_map",
  primary_schools: "public_primary_schools_map",
  public_primary_schools_map: "public_primary_schools_map",
  secondary_schools: "public_secondary_schools_map",
  public_secondary_schools_map: "public_secondary_schools_map",

  // population
  population: "population_distribution",
  population_distribution: "population_distribution",
  population_density: "population_density"
};

function resolveMetaKey(k){
  if(!k) return "";
  const key = String(k).trim();
  if(layerMetadata[key]) return key;

  // alias table
  const a = layerMetaAliases[key];
  if(a && layerMetadata[a]) return a;

  // common suffixes
  const candidates = [
    key + "_map",
    key + "_layer",
    key.replace(/\s+/g, "_"),
    key.replace(/\s+/g, "_") + "_map"
  ];
  for(const c of candidates){
    if(layerMetadata[c]) return c;
  }
  return key; // fallback (no metadata found)
}


function currentLayerTitle(){
  return (window.activeLayerTitle || '').trim() || 'None';
}
function currentLayerKey(){
  return window.activeLayerKey || null;
}

function renderMetadata(){
  if(!layerMetaBody || !layerMetaTitle) return;

  const rawKey = currentLayerKey();
  const uiTitle = currentLayerTitle();

  if(!rawKey){
    layerMetaTitle.textContent = 'Metadata';
    layerMetaBody.innerHTML = '<div style="color:rgba(232,242,255,0.8); font-size:13px;">No layer selected. Choose a layer from <b>Layers</b> then open Metadata.</div>';
    return;
  }

  const metaKey = resolveMetaKey(rawKey);
  const meta = layerMetadata[metaKey];

  // Prefer clean title from metadata if available, otherwise UI title
  const displayTitle = (meta && (meta.Title || meta.Layer || meta.LayerName)) ? (meta.Title || meta.Layer || meta.LayerName) : uiTitle;
  layerMetaTitle.textContent = 'Metadata ‚Äî ' + displayTitle;

  const rows = [
    ['Layer name', displayTitle || '‚Äî'],
    ['Key', metaKey || rawKey || '‚Äî']
  ];

  if(meta){
    if(meta.Theme) rows.push(['Theme', meta.Theme]);
    if(meta.Source) rows.push(['Source', meta.Source]);
    if(meta.Date) rows.push(['Date', meta.Date]);
    if(meta.Data_Availability) rows.push(['Data availability', meta.Data_Availability]);
    if(meta.CRS) rows.push(['CRS', meta.CRS]);
    if(meta.Format) rows.push(['Format', meta.Format]);

    // Only show resolution fields when they exist
    if(meta.spatial_resolution) rows.push(['Spatial resolution', meta.spatial_resolution]);
    if(meta.temporal_resolution) rows.push(['Temporal resolution', meta.temporal_resolution]);

    if(meta.Notes) rows.push(['Notes', meta.Notes]);
  } else {
    rows.push(['Theme', '‚Äî'], ['Source', '‚Äî'], ['Date', '‚Äî'], ['CRS', '‚Äî'], ['Format', '‚Äî'], ['Notes', '‚Äî']);
  }

  layerMetaBody.innerHTML =
    '<div class="meta-grid">' +
      rows.map(([a,b]) =>
        '<div class="meta-k">' + a + '</div><div class="meta-v">' + (b ?? '‚Äî') + '</div>'
      ).join('') +
    '</div>';
}

function openMetadata(){
  // Re-query in case DOM was loaded after script variables were initialized
  if(!layerMetaModal) layerMetaModal = document.getElementById('layerMetaModal');
  if(!layerMetaTitle) layerMetaTitle = document.getElementById('layerMetaTitle');
  if(!layerMetaBody)  layerMetaBody  = document.getElementById('layerMetaBody');
  if(!layerMetaClose) layerMetaClose = document.getElementById('layerMetaClose');

  if(!layerMetaModal) return;

  // Bind close handlers (only once) - fixes close button not working
  if(layerMetaClose && !layerMetaClose.__bound){
    layerMetaClose.addEventListener('click', closeMetadata);
    layerMetaClose.__bound = true;
  }
  if(layerMetaModal && !layerMetaModal.__bound){
    layerMetaModal.addEventListener('click', (e)=>{ if(e.target === layerMetaModal) closeMetadata(); });
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && layerMetaModal && layerMetaModal.style.display === 'flex') closeMetadata(); });
    layerMetaModal.__bound = true;
  }

  try{ renderMetadata(); }catch(err){
    console.error(err);
    if(layerMetaBody){
      layerMetaBody.innerHTML = '<div style="color:rgba(232,242,255,0.86); font-size:13px;">Metadata failed to render. Open the browser console for details.</div>';
    }
  }
  layerMetaModal.style.display = 'flex';
  try{ layerMetaModal.setAttribute('aria-hidden','false'); }catch(e){}
  if(layerMetaClose) layerMetaClose.focus();
}
function closeMetadata(){
  if(!layerMetaModal) return;
  layerMetaModal.style.display = 'none';
  try{ layerMetaModal.setAttribute('aria-hidden','true'); }catch(e){}


// Ensure Metadata button always opens the modal (robust for GitHub Pages load order)
document.addEventListener('DOMContentLoaded', ()=>{
  const btn = document.getElementById('atlasMetaBtn');
  if(btn && !btn.__metaBound){
    btn.addEventListener('click', ()=>{ openMetadata(); try{ closeSettings(); }catch(e){} });
    btn.__metaBound = true;
  }
});

}

if(layerMetaClose) layerMetaClose.addEventListener('click', closeMetadata);
if(layerMetaModal) layerMetaModal.addEventListener('click', (e)=>{ if(e.target === layerMetaModal) closeMetadata(); });
document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && layerMetaModal && layerMetaModal.style.display === 'flex') closeMetadata(); });

if(atlasMetaBtn){
  atlasMetaBtn.addEventListener('click', ()=>{ openMetadata(); closeSettings(); });
}

// ===== Export selected layer only =====
async function exportSelectedLayer(){
  if(!window.activeLayerKey || !window.activeLayer){
    toast('Select a layer first (Layers ‚Üí choose a map)', 'error', 2800);
    return;
  }

  // Hide UI overlays to export clean layer
  const ui = document.getElementById('map-ui');
  const legend = document.getElementById('mapLegend');
  const controls = document.querySelector('.leaflet-control-container');

  const prevUI = ui ? ui.style.display : '';
  const prevLegend = legend ? legend.style.display : '';
  const prevControls = controls ? controls.style.display : '';

  // Remove basemap temporarily to export only the active layer
  let basemapWasOn = false;
  try{
    if(window.activeBasemap && map.hasLayer(window.activeBasemap)){
      basemapWasOn = true;
      map.removeLayer(window.activeBasemap);
    }
  }catch(e){}

  try{
    if(ui) ui.style.display = 'none';
    if(legend) legend.style.display = 'none';
    if(controls) controls.style.display = 'none';

    // Let map re-render
    await new Promise(r => setTimeout(r, 180));

    const target = map.getContainer();
    const canvas = await html2canvas(target, { useCORS:true, backgroundColor: null, scale: 2 });

    const link = document.createElement('a');
    const safeName = (currentLayerTitle() || 'layer').replace(/[^a-z0-9\-\_]+/gi, '_');
    link.download = safeName + '_export.png';
    link.href = canvas.toDataURL('image/png');
    link.click();

    toast('Export saved', 'success', 1800);
  }catch(e){
    console.error(e);
    toast('Export failed (tile CORS may block)', 'error', 3200);
  }finally{
    // Restore basemap and UI
    try{
      if(basemapWasOn && window.activeBasemap){
        window.activeBasemap.addTo(map);
      }
    }catch(e){}
    try{ if(window.activeLayer && window.activeLayer.bringToFront) window.activeLayer.bringToFront(); }catch(e){}
    if(ui) ui.style.display = prevUI || '';
    if(legend) legend.style.display = prevLegend || '';
    if(controls) controls.style.display = prevControls || '';
  }
}

if(atlasExportBtn){
  atlasExportBtn.addEventListener('click', ()=>{ exportSelectedLayer(); closeSettings(); });
}

// Update "Selected layer" chip whenever layer changes
function refreshSelectedLayerChip(){
  if(!atlasCurrentLayerName) return;
  const title = currentLayerTitle();
  atlasCurrentLayerName.textContent = title || 'None';
}

// Expose so loadLayer can call it
window.refreshSelectedLayerChip = refreshSelectedLayerChip;
window.renderMetadata = renderMetadata;


const settingsBtn = document.getElementById('atlasSettingsBtn');
const settingsPanel = document.getElementById('atlasSettings');
const settingsClose = document.getElementById('atlasSettingsClose');
const basemapSel = document.getElementById('atlasBasemap');
const atlasBasemapToggleBtn = document.getElementById('atlasBasemapToggleBtn');
let basemapEnabled = true;
const showLegendChk = document.getElementById('atlasShowLegend');
const showCoordsChk = document.getElementById('atlasShowCoords');

function openSettings(){
  if(!settingsPanel) return;
  settingsPanel.classList.add('open');
  settingsPanel.setAttribute('aria-hidden','false');
}
function closeSettings(){
  if(!settingsPanel) return;
  settingsPanel.classList.remove('open');
  settingsPanel.setAttribute('aria-hidden','true');
}

if(settingsBtn) settingsBtn.addEventListener('click', ()=>{
  if(!settingsPanel) return;
  if(settingsPanel.classList.contains('open')) closeSettings();
  else openSettings();
});
if(settingsClose) settingsClose.addEventListener('click', closeSettings);

// Click outside closes (only when clicking on map-ui backdrop isn't possible; so we use ESC)
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape') closeSettings();
});

// Basemap switching
function setBasemap(which){
  const next = (which === 'streets') ? baseStreets : baseImagery;
  if(next === activeBasemap) return;

  // remove current basemap if present
  try{ map.removeLayer(activeBasemap); }catch(e){}

  activeBasemap = next;
  window.activeBasemap = activeBasemap;

  // only add if enabled
  if(basemapEnabled){
    try{ activeBasemap.addTo(map); }catch(e){}
  }
}
if(basemapSel){
  basemapSel.addEventListener('change', ()=> setBasemap(basemapSel.value));
}


// Basemap ON/OFF button
function syncBasemapToggleUI(){
  if(!atlasBasemapToggleBtn) return;
  atlasBasemapToggleBtn.setAttribute('aria-pressed', basemapEnabled ? 'true' : 'false');
  atlasBasemapToggleBtn.textContent = basemapEnabled ? 'ON' : 'OFF';
  atlasBasemapToggleBtn.classList.toggle('is-off', !basemapEnabled);
}
if(atlasBasemapToggleBtn){
  atlasBasemapToggleBtn.addEventListener('click', ()=>{
    basemapEnabled = !basemapEnabled;
    try{
      if(basemapEnabled) activeBasemap.addTo(map);
      else map.removeLayer(activeBasemap);
    }catch(e){}
    syncBasemapToggleUI();
  });
  syncBasemapToggleUI();
}

// Legend show/hide
if(showLegendChk && legendEl){
  showLegendChk.addEventListener('change', ()=>{
    legendEl.style.display = showLegendChk.checked ? '' : 'none';
  });
}

// Coords enable/disable
if(showCoordsChk){
  showCoordsChk.addEventListener('change', ()=>{
    coordsEnabled = !!showCoordsChk.checked;
    if(!coordsEnabled && coordEl){
      coordEl.style.display = 'none';
    }
  });
}

function setLegend(layerTitle){
  if(!legendBody) return;
  legendBody.innerHTML = `
    <div class="legend-row">
      <span class="legend-swatch"></span>
      <span class="legend-text">${layerTitle || 'No layer selected'}</span>
    </div>
  `;
}

// Toast notifications (top-center)
const toastHost = document.getElementById('toastHost');
function toast(message, kind='info', ms=2400){
  if(!toastHost) return;
  const el = document.createElement('div');
  el.className = `toast ${kind}`;
  const tag = kind === 'success' ? 'Loaded' : (kind === 'error' ? 'Error' : 'Info');
  el.innerHTML = `<span>${message}</span><span class="tag">${tag}</span>`;
  toastHost.appendChild(el);
  // animate in
  requestAnimationFrame(()=>el.classList.add('show'));
  // remove
  setTimeout(()=>{
    el.classList.remove('show');
    setTimeout(()=>{ try{ el.remove(); }catch(e){} }, 220);
  }, ms);
}


// Sample layers (placeholders)
// Replace each layer with your real GeoJSON, WMS, tiles, etc.
function demoCircle(label, lat, lon, radius){
  const c = L.circle([lat, lon], {
    radius: radius,
    weight: 2,
    fillOpacity: 0.12
  });
  c.bindPopup('<b>' + label + '</b><br/>Demo layer placeholder. Connect your real data source here.');
  return c;
}

const sampleLayers = {
landcover:  demoCircle('Landcover Map', -6.79, 39.25, 2200),
  police:     demoCircle('Police Stations Map', -6.79, 39.25, 2000),
  health:     demoCircle('Public Health Centres Map', -6.79, 39.25, 2000),
  primary:    demoCircle('Public Primary Schools Map', -6.79, 39.25, 2000),
  secondary:  demoCircle('Public Secondary Schools Map', -6.79, 39.25, 2000),
  roads:      demoCircle('Road Network Map', -6.79, 39.25, 2400),
  transport:  demoCircle('Transport Network Map', -6.79, 39.25, 2400),
  water:      demoCircle('Water Supply Network', -6.79, 39.25, 2100),
  boreholes:  demoCircle('Borehole Map & Service Areas', -6.79, 39.25, 2100),
  popdist:    demoCircle('Population Distribution', -6.79, 39.25, 2600),
  popdens:    demoCircle('Population Density Map', -6.79, 39.25, 2600),
  slope:      demoCircle('Slope Map', -6.79, 39.25, 2300),
  aspect:     demoCircle('Aspect Map', -6.79, 39.25, 2300),
  hillshade:  demoCircle('Hillshade Map', -6.79, 39.25, 2300),
  contours:   demoCircle('Contours Map', -6.79, 39.25, 2300),
  topo:       demoCircle('Topographic Map', -6.79, 39.25, 2300),
  lcchange:   demoCircle('Landcover Change Map', -6.79, 39.25, 2200),
  landuse:    demoCircle('Land Use Map', -6.79, 39.25, 2200),
  rainfall:   demoCircle('Rainfall Map', -6.79, 39.25, 2600),
  airtemp:    demoCircle('Air Temperature Map', -6.79, 39.25, 2600),
  lst:        demoCircle('Land Surface Temperature Map', -6.79, 39.25, 2600),
  ndvi:       demoCircle('Normalized Difference Vegetation Index (NDVI)', -6.79, 39.25, 2600),
  correlation: demoCircle('Correlation (Climate)', -6.79, 39.25, 2800),
  trend:       demoCircle('Trend (Climate)', -6.79, 39.25, 2800)
};

let activeLayer;
window.activeLayer = null;
window.activeLayerKey = null;
window.activeLayerTitle = '';

function loadLayer(type){
  if(activeLayer) map.removeLayer(activeLayer);

  const layer = sampleLayers[type];
  if(!layer){
    toast('Layer not found: ' + type, 'error', 3500);
    return;
  }

  const label = (layer && layer.getPopup && layer.getPopup()) ? (layer.getPopup().getContent() || '') : '';
  toast('Loading layer‚Ä¶', 'info', 1100);

  activeLayer = layer;
  activeLayer.addTo(map);

  // Update legend
  const cleanTitle = (label || '').toString().replace(/<[^>]*>/g,'').trim();
  // Track selected layer (for Export + Metadata)
  window.activeLayerKey = type;
  window.activeLayerTitle = cleanTitle || (typeof type === 'string' ? type : 'Selected layer');
  window.activeLayer = activeLayer;
  if(window.refreshSelectedLayerChip) window.refreshSelectedLayerChip();
  if(window.renderMetadata) window.renderMetadata();
  setLegend(window.activeLayerTitle || 'Selected layer');
  toast('Layer ready', 'success', 1800);

  // Open popup for quick feedback
  if(activeLayer.getPopup){
    activeLayer.openPopup();
  }
}


// ============ About Us modal (UI only) ============
document.addEventListener('DOMContentLoaded', () => {
  const aboutBtn = document.getElementById('aboutBtn');
  const modal = document.getElementById('aboutModal');
  const closeBtn = document.getElementById('aboutClose');
  const aboutContactBtn = document.getElementById('aboutContactBtn');
  const contactModal = document.getElementById('contactModal');
  const contactModalClose = document.getElementById('contactModalClose');

  if(!aboutBtn || !modal || !closeBtn) return;

  function openAbout(){
    modal.classList.add('open');
    modal.setAttribute('aria-hidden', 'false');
    closeBtn.focus();
  }
  function closeAbout(){
    modal.classList.remove('open');
    modal.setAttribute('aria-hidden', 'true');
    aboutBtn.focus();
  }

  aboutBtn.addEventListener('click', openAbout);
  closeBtn.addEventListener('click', closeAbout);

  // Contact button inside About modal
  if(aboutContactBtn && contactModal){
    aboutContactBtn.addEventListener('click', ()=>{
      // Ensure About stays open; open Contact modal on top
      contactModal.style.display = 'flex';
      try{ contactModal.setAttribute('aria-hidden','false'); }catch(e){}
      if(contactModalClose) contactModalClose.focus();
    });
  }

  // Click outside card closes
  modal.addEventListener('click', (e)=>{
    if(e.target === modal) closeAbout();
  });

  // ESC closes
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Escape' && modal.classList.contains('open')) closeAbout();
  });
});
</script>
<!-- ================= ABOUT US MODAL ================= -->
<div aria-hidden="true" aria-labelledby="aboutTitle" aria-modal="true" class="modal" id="aboutModal" role="dialog">
<div class="modal-card">
<div class="modal-head">
<div>
<h2 id="aboutTitle">About Us</h2>
<p>Ardhi University ‚Ä¢ Department of Geospatial Sciences and Technology ‚Ä¢ GS 334 (Project III) ‚Ä¢ February 2026</p>
</div>
<div class="modal-head-actions">
<button aria-label="Close" class="modal-close" id="aboutClose" type="button">‚úï</button>
</div>
</div>
<div class="modal-body">
<div class="modal-grid">
<div class="modal-panel">
<b>Project overview</b>
<div>
            This web atlas is an in-semester GIS &amp; Remote Sensing production project for <b>GS 334 ‚Äì Project III (Geospatial Analytics for Societal Challenges)</b>.
            The project area is <b>Ubungo District (Dar es Salaam City)</b>. The aim is to apply GIS &amp; RS skills in a realistic, multi-task production workflow
            from planning and data acquisition to analysis, quality control, and final presentation.
          </div>
<b style="margin-top:10px">Core workflow</b>
<ul>
<li>Study Terms of Reference (deliverables, datasets, methods, software)</li>
<li>Reconnaissance (satellite imagery / Google Earth + stakeholder introduction)</li>
<li>Data acquisition (field + online sources)</li>
<li>Data exploration, processing &amp; analysis</li>
<li>Quality control (validation, verification, accuracy assessment)</li>
<li>Data presentation (maps, web atlas, reporting)</li>
</ul>
</div>
<div class="modal-panel">
<b>Deliverables</b>
<ul>
<li>Production flow diagram + work plan / time schedule</li>
<li>Web-based GIS Ubungo District Atlas (general &amp; thematic maps)</li>
<li>Technical report + oral group presentation</li>
</ul>
<b style="margin-top:10px">Project supervision</b>
<ul>
<li>Dr. Anastazia Msusa</li>
<li>Mr. Michael Mavura</li>
<li>Mr. Iriael Mlay</li>
<li>Ms. Christina Mshana</li>
</ul>
<b style="margin-top:10px">Assessment &amp; schedule</b>
<ul>
<li>Three assessed oral presentations (after fieldwork, after office work, after draft report)</li>
<li>Final submission deadline: <b>06 March 2026</b></li>
</ul>
</div>
</div>
<div style="display:flex; justify-content:center; margin-top:18px;">
  <button class="modal-action-btn" id="aboutContactBtn" type="button" title="Contact the team">‚úâÔ∏è Contact Us</button>
</div>

</div>
</div>
</div>
<button id="contactBtn" style="position:fixed; right:20px; bottom:90px; z-index:9999;
background:#1f4e79; color:white; border:none; padding:12px 16px;
border-radius:8px; font-weight:600; cursor:pointer;; display:none;">
Contact Us
</button>
<div id="contactModal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:10000; align-items:center; justify-content:center; padding:20px;">
<div id="contactModalCard" style="background:#ffffff; border-radius:16px; width:480px; max-width:95vw;
     box-shadow:0 20px 60px rgba(0,0,0,0.25); overflow:hidden; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;">
<div class="contact-header" style="padding:16px 18px; background:linear-gradient(135deg,#123a63,#1f4e79); color:#fff; display:flex; align-items:center; justify-content:space-between;">
<div style="display:flex; align-items:center; gap:10px;">
<div aria-hidden="true" style="width:36px; height:36px; border-radius:10px; background:rgba(255,255,255,0.18);
           display:grid; place-items:center; font-size:18px;">‚úâÔ∏è</div>
<div>
<div style="font-weight:700; font-size:16px; line-height:1.1;">Contact</div>
<div style="opacity:0.92; font-size:12.5px; margin-top:2px;">Ubungo District Web Atlas</div>
</div>
</div>
<button aria-label="Close" id="contactModalClose" style="border:none; background:rgba(255,255,255,0.18); color:#fff; width:36px; height:36px; border-radius:10px;
             cursor:pointer; font-size:18px; line-height:1;" type="button">‚úï</button>
</div>
<div id="contactModalBody" style="padding:16px 18px 18px 18px; color:#0f172a;">
<div style="font-size:13.5px; margin:0 0 12px 0; color:#334155;">
      For enquiries contact
    </div>
<!-- Scroll container for contacts -->
<div id="contactScroll" style="max-height:50vh; overflow:auto; padding-right:6px;">
<div class="contact-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255622521594" title="Call +255 622 521 594">+255 622 521 594</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255616788034" title="Call +255 616 788 034">+255 616 788 034</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255686764197" title="Call +255 686 764 197">+255 686 764 197</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255625838344" title="Call +255 625 838 344">+255 625 838 344</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255685158302" title="Call +255 685 158 302">+255 685 158 302</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255687295510" title="Call +255 687 295510">+255 687 295510</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255678484554" title="Call +255 678 484 554">+255 678 484 554</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255769520172" title="Call +255 769 520 172">+255 769 520 172</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255744968968" title="Call +255 744 968 968">+255 744 968 968</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255672296161" title="Call +255 672 296 161">+255 672 296 161</a>
</div>
<div class="contact-item">
<div aria-hidden="true" class="contact-icon">üìû</div>
<a class="contact-link" href="tel:+255761854633" title="Call +255 761 854 633">+255 761 854 633</a>
</div>
</div>
</div>
<!-- Email LAST -->
<div class="contact-item" style="margin-top:12px;">
<div aria-hidden="true" class="contact-icon" style="background:#fef9c3;">üìß</div>
<a class="contact-link" href="mailto:info.atlasproject0@gmail.com" title="Email info.atlasproject0@gmail.com">info.atlasproject0@gmail.com</a>
</div>
</div>
</div>
<style>/* Align with About modal: clean cards + subtle borders */
  #contactModal .contact-item {
    display:flex; gap:8px; align-items:center;
    padding:8px 10px;
    border:1px solid #e2e8f0;
    border-radius:12px;
    background:#fff;
  }
  #contactModal .contact-icon {
    width:28px; height:28px;
    border-radius:10px;
    background:#eef2ff;
    display:grid; place-items:center;
    flex: 0 0 auto;
    font-size:14px;
  }
  /* Increase visibility: stronger color, full opacity, slightly heavier weight */
  #contactModal .contact-link {
    font-size:12.5px;
    color:#0f172a;
    opacity:1;
    font-weight:650;
    text-decoration:none;
    line-height:1.15;
    display:block;
  }
  #contactModal .contact-link:hover {
    text-decoration:underline;
  }
  /* Scrollbar styling (subtle) */
  #contactScroll::-webkit-scrollbar {
    width:10px;
  }
  #contactScroll::-webkit-scrollbar-thumb {
    background:rgba(31,78,121,0.25);
    border-radius:999px;
    border:3px solid transparent;
    background-clip:content-box;
  }
  #contactScroll::-webkit-scrollbar-track {
    background:transparent;
  }



/* =========================
   RESPONSIVE / FLEX UI ONLY
   (Views + logic untouched)
   ========================= */

/* Ensure predictable sizing */
*, *::before, *::after { box-sizing: border-box; }

html, body { height: 100%; width: 100%; }
body { margin: 0; overflow-x: hidden; }

/* Make app containers fluid */
#app, .app, .container, .layout, .shell { width: 100%; max-width: 100%; }

/* Prevent fixed panels from causing horizontal scroll on small screens */
.hero-card, .heroCard, .card, .panel, .sidebar, .toolbar, .topbar, .header-bar, .headerBar {
  max-width: 100%;
}

/* Make common grids flexible without changing structure */
.grid, .row, .columns, .cards, .options, .controls {
  max-width: 100%;
}

/* If a sidebar exists, allow wrapping on small screens */
@media (max-width: 980px) {
  .layout, .shell, .container, .row, .columns {
    flex-wrap: wrap !important;
  }
  .sidebar, .left-panel, .leftPanel {
    width: 100% !important;
    max-width: 100% !important;
    order: 2;
  }
  .main, .content, .map-area, .mapArea, .viewer, .viewer-container {
    width: 100% !important;
    max-width: 100% !important;
    order: 1;
  }
}

/* Make top actions wrap nicely */
@media (max-width: 680px) {
  .topbar, .header-bar, .headerBar {
    flex-wrap: wrap !important;
    gap: 10px !important;
  }
  .topbar .actions, .header-bar .actions, .headerBar .actions,
  .topbar-actions, .header-actions {
    width: 100% !important;
    justify-content: flex-start !important;
    flex-wrap: wrap !important;
  }
}

/* Responsive modal sizing (About + Contact) */
#aboutModalCard, #contactModalCard {
  width: min(520px, 92vw) !important;
  max-width: 92vw !important;
}
#contactModalBody, #aboutModalCard {
  max-height: 78vh;
}
#contactScroll {
  max-height: 52vh !important;
}

/* Make two-column contact grid collapse to one column on small screens */
@media (max-width: 520px) {
  #contactModal .contact-grid { grid-template-columns: 1fr !important; }
}

/* Map / canvas / viewers fill available space without overflowing */
#map, #map2d, #leafletMap, .leaflet-container,
#cesiumContainer, .cesium-container,
.canvas, .viewer, .viewer-container {
  width: 100% !important;
  max-width: 100% !important;
}

/* Keep buttons readable on small screens */
button, .btn {
  max-width: 100%;
}

/* Make any fixed-width card content wrap safely */
p, li, a, span, div {
  overflow-wrap: anywhere;
}


/* ==== Leaflet scale bar visibility fix ==== */
.leaflet-control-container{
  position: absolute !important;   /* restore Leaflet default */
  inset: 0;                         /* allow top/bottom control anchors */
  z-index: 3000 !important;         /* above custom overlays */
  pointer-events: none;             /* Leaflet controls enable their own events */
}
.leaflet-top,
.leaflet-bottom{
  z-index: 3001 !important;
  pointer-events: none;
}
.leaflet-control{
  pointer-events: auto;             /* clickable controls */
}

/* Scale bar styling + spacing */
.leaflet-control-scale{
  margin-left: 12px;
  margin-bottom: 12px;
  display: block !important;
}
.leaflet-control-scale-line{
  background: rgba(10, 20, 28, 0.72) !important;
  color: rgba(232,242,255,0.94) !important;
  border: 1px solid rgba(255,255,255,0.22) !important;
  border-top: none !important;
  font-weight: 700 !important;
  letter-spacing: 0.2px;
}


/* ==== Resizable sidebar + Layers accordion (UI only) ==== */
:root{ --sidebar-w: 320px; }

.sidebar{
  position: relative;
  width: var(--sidebar-w);
  min-width: 220px;
  max-width: 560px;
}

.sidebar-controls{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin: 10px 0 8px 0;
}

.layers-toggle{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  width:100%;
  flex: 1 1 auto;
  padding: 10px 12px;
}

.layers-toggle .chev{
  font-size: 12px;
  opacity: 0.95;
}

.sidebar-size-buttons{
  display:flex;
  gap:8px;
  flex: 0 0 auto;
}

.sidebar-size-buttons button{
  width: 36px;
  height: 36px;
  padding: 0;
  display:grid;
  place-items:center;
  font-size: 18px;
  font-weight: 800;
}

.layers-group{
  display:block;
  overflow:auto;
  max-height: calc(100vh - 210px); /* allows scrolling if many layers */
  padding-right: 4px;
}

.layers-group:not(.open){
  display:none;
}

.sidebar-resizer{
  position:absolute;
  top:0;
  right:-3px;
  width: 8px;
  height: 100%;
  cursor: col-resize;
  z-index: 2000;
  background: transparent;
}

.sidebar-resizer::after{
  content:"";
  position:absolute;
  top:12px;
  bottom:12px;
  left:50%;
  width:2px;
  transform:translateX(-50%);
  border-radius:999px;
  background: rgba(255,255,255,0.16);
}

@media (hover: none) and (pointer: coarse){
  .sidebar-resizer{ width: 14px; right:-6px; }
}

@media (max-width: 980px){
  .sidebar{ width: 100% !important; min-width: 0; max-width: 100% !important; }
  .sidebar-resizer{ display:none; }
  .layers-group{ max-height: 45vh; }
}
/* Show home-only controls (labels, borders, contact, search) only on HOME */
#explore #globeControls,
#explore .topbar-actions,
#explore #contactBtn,
#explore #labelsToggle,
#explore #bordersToggle {
  display: none !important;
}


  /* ================= HOME CONTROLS FADE (during transition) ================= */
  #home .topbar,
  #home .hero,
  #home #globeControls{
    transition: opacity 320ms ease, transform 320ms ease;
    opacity: 1;
  }
  #home .topbar{ transform: translateY(0); }
  #home .hero{ transform: translateY(0); }
  #home #globeControls{ transform: translateY(0); }

  /* When HOME section is not active, fade controls out smoothly */
  #home:not(.active) .topbar{
    opacity: 0;
    transform: translateY(-8px);
  }
  #home:not(.active) .hero{
    opacity: 0;
    transform: translateY(-6px);
  }
  #home:not(.active) #globeControls{
    opacity: 0;
    transform: translateY(10px);
  }


  /* ================= ATLAS FLOATING SETTINGS ================= */
  .atlas-settings-btn{
    position:absolute;
    top: 16px;
    right: 16px;
    z-index: 1400;
    width: 40px;
    height: 40px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(10, 20, 28, 0.72);
    color: rgba(232,242,255,0.92);
    box-shadow: 0 14px 34px rgba(0,0,0,0.45);
    backdrop-filter: blur(12px);
    cursor:pointer;
    pointer-events:auto;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size: 18px;
    line-height: 1;
  }
  .atlas-settings-btn:hover{ background: rgba(10, 20, 28, 0.80); }

  .atlas-settings{
    position:absolute;
    top: 64px;
    right: 16px;
    z-index: 1400;
    width: 260px;
    background: rgba(10, 20, 28, 0.78);
    border: 1px solid rgba(255,255,255,0.14);
    border-radius: 16px;
    box-shadow: 0 18px 45px rgba(0,0,0,0.55);
    backdrop-filter: blur(14px);
    overflow:hidden;
    pointer-events:auto;
    transform-origin: top right;
    transform: translateY(-6px) scale(0.98);
    opacity: 0;
    visibility: hidden;
    transition: opacity 180ms ease, transform 180ms ease, visibility 180ms ease;
  }
  .atlas-settings.open{
    opacity: 1;
    visibility: visible;
    transform: translateY(0) scale(1);
  }
  .atlas-settings .head{
    padding: 10px 12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    border-bottom: 1px solid rgba(255,255,255,0.10);
    color: rgba(232,242,255,0.92);
    font-size: 12px;
    letter-spacing: .2px;
  }
  .atlas-settings .body{
    padding: 10px 12px 12px 12px;
    display:flex;
    flex-direction:column;
    gap:10px;
    color: rgba(232,242,255,0.86);
    font-size: 12px;
  }
  .atlas-settings label{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding: 8px 10px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(255,255,255,0.06);
  }
  .atlas-settings select, .atlas-settings input[type="checkbox"]{
    pointer-events:auto;
  }
  .atlas-settings select{
    width: 120px;
    padding: 6px 8px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.25);
    color: rgba(232,242,255,0.92);
    outline:none;
  }
  .atlas-settings .xbtn{
    width: 28px;
    height: 28px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: rgba(232,242,255,0.92);
    cursor:pointer;
  }
  .atlas-settings .xbtn:hover{ background: rgba(255,255,255,0.10); }


  /* Settings search row */
  .atlas-settings .search-row{
    display:flex;
    gap:8px;
    align-items:center;
  }
  .atlas-settings .search-row input{
    flex: 1 1 auto;
    padding: 7px 9px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(0,0,0,0.25);
    color: rgba(232,242,255,0.92);
    outline:none;
  }
  .atlas-settings .search-row button{
    flex: 0 0 auto;
    padding: 7px 10px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(52,152,219,0.80);
    color: #fff;
    cursor:pointer;
    font-weight:800;
  }
  .atlas-settings .search-row button:hover{ filter: brightness(1.06); }

</style>
</div>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const modal = document.getElementById("contactModal");
  const btn = document.getElementById("contactBtn");
  const closeX = document.getElementById("contactModalClose");

  function openModal(){ if(modal) modal.style.display = "flex"; }
  function closeModal(){ if(modal) modal.style.display = "none"; }

  if(btn) btn.addEventListener("click", openModal);
  if(closeX) closeX.addEventListener("click", closeModal);

  // click outside card closes
  window.addEventListener("click", function(ev){
    if(ev.target === modal) closeModal();
  });

  // ESC closes
  window.addEventListener("keydown", function(ev){
    if(ev.key === "Escape") closeModal();
  });
});
</script><script>
// Resizable sidebar + Layers accordion JS
document.addEventListener("DOMContentLoaded", () => {
  // Layers accordion
  const toggle = document.getElementById("layersToggle");
  const group = document.getElementById("layersGroup");
  if (toggle && group) {
    toggle.addEventListener("click", () => {
      const isOpen = group.classList.toggle("open");
      toggle.setAttribute("aria-expanded", String(isOpen));
      const chev = toggle.querySelector(".chev");
      if (chev) chev.textContent = isOpen ? "‚ñæ" : "‚ñ∏";
    });
  }

  // Sidebar resize (drag)
  const resizer = document.getElementById("sidebarResizer");
  const root = document.documentElement;
  const minW = 220, maxW = 560;

  function setW(px){
    const clamped = Math.max(minW, Math.min(maxW, px));
    root.style.setProperty("--sidebar-w", clamped + "px");
  }

  // +/- buttons
  const btnSmaller = document.getElementById("sidebarSmaller");
  const btnLarger = document.getElementById("sidebarLarger");
  if (btnSmaller) btnSmaller.addEventListener("click", () => {
    const cur = parseInt(getComputedStyle(root).getPropertyValue("--sidebar-w")) || 320;
    setW(cur - 24);
  });
  if (btnLarger) btnLarger.addEventListener("click", () => {
    const cur = parseInt(getComputedStyle(root).getPropertyValue("--sidebar-w")) || 320;
    setW(cur + 24);
  });

  if (!resizer) return;

  let startX = 0, startW = 0, dragging = false;

  function onDown(clientX){
    dragging = true;
    startX = clientX;
    const cur = parseInt(getComputedStyle(root).getPropertyValue("--sidebar-w")) || 320;
    startW = cur;
    document.body.style.userSelect = "none";
    document.body.style.cursor = "col-resize";
  }

  function onMove(clientX){
    if (!dragging) return;
    const dx = clientX - startX;
    setW(startW + dx);
  }

  function onUp(){
    if (!dragging) return;
    dragging = false;
    document.body.style.userSelect = "";
    document.body.style.cursor = "";
  }

  resizer.addEventListener("mousedown", (e) => onDown(e.clientX));
  window.addEventListener("mousemove", (e) => onMove(e.clientX));
  window.addEventListener("mouseup", onUp);

  // Touch support
  resizer.addEventListener("touchstart", (e) => {
    const t = e.touches[0];
    if (!t) return;
    onDown(t.clientX);
  }, {passive:true});
  window.addEventListener("touchmove", (e) => {
    const t = e.touches[0];
    if (!t) return;
    onMove(t.clientX);
  }, {passive:true});
  window.addEventListener("touchend", onUp);
});
</script><script>
// Dashboard KPIs from Trend Summary
(function() {
  const els = {
    ndvi: document.getElementById("kpiNdvi"),
    rain: document.getElementById("kpiRain"),
    at:   document.getElementById("kpiAT"),
    lst:  document.getElementById("kpiLST"),
  };

  function fmt(val, kind) {
    if (val === null || val === undefined || val === "" || Number.isNaN(Number(val))) return "--";
    const num = Number(val);
    if (kind === "ndvi") return num.toFixed(2);
    if (kind === "rain") return Math.round(num).toString();
    // temps
    return num.toFixed(1);
  }

  function applySummary(s) {
    if (!s || typeof s !== "object") return false;

    // accept multiple key spellings
    const ndvi = s.mean_ndvi ?? s.meanNDVI ?? s.ndvi_mean ?? s.ndvi ?? s.MeanNDVI;
    const rain = s.mean_rainfall ?? s.meanRainfall ?? s.rain_mean ?? s.rainfall ?? s.Rainfall;
    const at   = s.mean_air_temperature ?? s.meanAirTemperature ?? s.mean_at ?? s.air_temperature ?? s.airTemperature ?? s.AT ?? s.AirTemperature;
    const lst  = s.mean_lst ?? s.meanLST ?? s.lst_mean ?? s.lst ?? s.LST;

    let updated = false;
    if (els.ndvi && ndvi !== undefined) { els.ndvi.textContent = fmt(ndvi, "ndvi"); updated = true; }
    if (els.rain && rain !== undefined) { els.rain.textContent = fmt(rain, "rain"); updated = true; }
    if (els.at   && at   !== undefined) { els.at.textContent   = fmt(at, "temp"); updated = true; }
    if (els.lst  && lst  !== undefined) { els.lst.textContent  = fmt(lst, "temp"); updated = true; }
    return updated;
  }

  function tryLocalStorage() {
    try {
      const raw = localStorage.getItem("atlasTrendSummary");
      if (!raw) return false;
      const obj = JSON.parse(raw);
      return applySummary(obj);
    } catch(e) {
      return false;
    }
  }

  async function tryFetch(paths) {
    for (const p of paths) {
      try {
        const res = await fetch(p, { cache: "no-store" });
        if (!res.ok) continue;
        const obj = await res.json();
        if (applySummary(obj)) return true;
      } catch(e) {}
    }
    return false;
  }

  async function init() {
    // 1) localStorage from Trend page (best)
    if (tryLocalStorage()) return;

    // 2) optional JSON file exported by Trend page
    await tryFetch(["trend_summary.json", "data/trend_summary.json"]);
  }

  document.addEventListener("DOMContentLoaded", init);

  // Live update when Trend page writes to localStorage
  window.addEventListener("storage", (ev) => {
    if (ev.key === "atlasTrendSummary") {
      try {
        const obj = JSON.parse(ev.newValue || "{}");
        applySummary(obj);
      } catch(e) {}
    }
  });
})();
</script>
<div>üü• LST</div>
<div>üü¶ Rainfall</div>
<div>‚¨õ Roads</div>
</div>




<!-- ================= LAYER METADATA MODAL ================= -->
<div id="layerMetaModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div id="layerMetaCard">
    <div class="head">
      <b id="layerMetaTitle">Metadata</b>
      <button id="layerMetaClose" type="button" aria-label="Close">‚úï</button>
    </div>
    <div class="body" id="layerMetaBody">
      <!-- populated by JS -->
    </div>
  </div>
</div>

</body>
</html>
